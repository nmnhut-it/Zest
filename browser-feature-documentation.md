# Zest Browser Feature Documentation

## Overview

The Zest Browser Feature is an integrated web browser that enhances the IDE's capabilities by providing seamless web content rendering directly within the development environment. This feature leverages the JCEF (Java Chromium Embedded Framework) to deliver a full-featured browsing experience without requiring users to switch to external applications.

## Key Features

### 1. Embedded Browser
- Provides a complete web browser inside the IDE as a tool window
- Supports standard browsing capabilities (navigation, page refresh, URL entry)
- Renders HTML, CSS, JavaScript, and other web content with Chrome-level compatibility

### 2. AI Integration
- Automatically detects browser-related commands in AI conversations
- Supports displaying AI-generated HTML/CSS directly in the browser window
- Recognizes natural language requests like "show this in browser" or "open URL"

### 3. Two-Way Communication
- Allows selected code to be sent directly to the browser with a single action
- Provides JavaScript bridge for communication between IDE and web content
- Enables web content to trigger IDE actions via the bridge API

### 4. Developer Workflow Enhancement
- Preview HTML/CSS/JavaScript directly in IDE without switching to external browsers
- Test web components and applications within the development environment
- Seamlessly integrate with web services and documentation

## Technical Architecture

The browser feature is built on several key components:

![Browser Feature Architecture](https://mermaid.ink/img/pako:eNp1kstqwzAQRX9l0KqFJC_isXGhTQMNbUJfq2KhjB2rojQaZY2bhPx7ZTtOGgpdCM3cO3M1jMmJ14oEiTXJjL0pXzSaKZFKo-tQ8BLHyDe0ZioXyrQPCLzQlWZiH_mqcXpbXogtCnkxDM--EVYgVJX4TnDCilI4cqWZbQXrRK1ZEFJizbA5ZmLDXS20YR5JYOlZSptxjaqD-iVQlmJDFcr0LEWUbSfL40R7iRNs10vBHa20UtuOSNgzZZ8WOOvJb4G2rYMx5O0_F7s3ZkXkE11M9CxFpyL0xoV4qnbj86M4Gu91M3OjMGBrQFMHumwdPTpPKP3VwuEDvHbLNr3BXYJYUnkLUZI62iN1DclMOtLYkqzZg9MNpzklxIcxrx03kCCKq7aLcB_xpK1lGzJSxbR-6nAjJaQNRPK9qdz3hPaJeJKz-4sZZ3p38IZ4SnlTXy_-AEwcsdU?type=png)

### Components:

1. **WebBrowserToolWindow**: Factory class that creates and initializes the browser tool window

2. **WebBrowserPanel**: UI component that contains the browser and navigation controls

3. **WebBrowserService**: Project-level service for managing browser functionality across the plugin

4. **JCEFBrowserManager**: Encapsulates the JCEF browser implementation details

5. **BrowserIntegrationManager**: Processes AI-related commands for browser interactions

6. **BrowserIntegrator**: Connects the AI service with the browser components

7. **JavaScriptBridge**: Enables two-way communication between Java and JavaScript

## Usage Guide

### Accessing the Browser

1. Open the "ZPS Chat" tool window from the IDE's tool window bar (usually on the right)
2. The browser will automatically initialize and display the default page (https://chat.zingplay.com)

### Basic Navigation

- Use the navigation bar to enter URLs directly
- Click the back, forward, and refresh buttons in the top-left corner
- URLs entered without a protocol (http://, https://) will default to https://

### AI Integration

The browser feature automatically integrates with the AI assistant, recognizing several patterns:

1. **Show content in browser**: When you ask the AI to "show this in the browser" or similar phrases, any code blocks in the AI's response will be displayed in the browser window.

2. **Open URL**: When you ask the AI to "open URL" or "navigate to" followed by a URL, the browser will load that URL.

3. **Preview generated code**: HTML/CSS code generated by the AI can be previewed with a simple natural language request.

Example prompts:
- "Generate a simple HTML page with a blue button and show it in the browser"
- "Open the URL https://example.com in the browser"
- "Create a CSS grid layout and display it in the browser"

### Sending Code to Browser

1. Select code in the editor
2. Right-click and choose "Send to ZPS Chat" from the context menu (or use the assigned shortcut)
3. The code will be sent to the browser, and the browser window will be activated

### Developer Features

#### JavaScript Bridge

The JavaScript bridge allows web content to communicate with the IDE using a standardized API:

```javascript
// Call from web page to IDE
window.intellijBridge.callIDE('actionName', { key: 'value' })
  .then(response => console.log('IDE response:', response))
  .catch(error => console.error('Error:', error));

// Receive content from IDE
document.addEventListener('ideTextReceived', event => {
  const textFromIDE = event.detail.text;
  console.log('Received from IDE:', textFromIDE);
});
```

#### Testing Browser Functionality

A test action is available to verify the browser functionality:

1. Open the ZPS Chat tool window
2. Use the "Test Browser" action from the IDE action menu
3. The test will verify browser loading, JavaScript execution, and bridge availability

## Implementation Details

### Technologies Used

- **JCEF (Java Chromium Embedded Framework)**: Provides Chromium rendering capabilities
- **Swing/JB UI Components**: For UI integration with the IDE
- **JavaScriptBridge**: Custom implementation for IDE-browser communication

### Key Classes

- **WebBrowserToolWindow**: Initializes the tool window and browser components
- **WebBrowserPanel**: Main UI container for the browser
- **WebBrowserService**: Service for browser functionality
- **JCEFBrowserManager**: Manages the JCEF browser instance
- **BrowserIntegrationManager**: Handles AI integration

### Extension Points

The browser feature integrates with the IDE through:

1. Tool Window extension point
2. Action extension points for context menu integration
3. Project service for browser management

## Troubleshooting

### Common Issues

1. **Browser doesn't load**: Check if JCEF is properly installed with your IDE version
2. **JavaScript bridge not working**: Verify the page has fully loaded before attempting bridge calls
3. **AI integration not detecting commands**: Review the command patterns expected by the integration

### Logging

The browser feature uses the IDE's logging system. To view logs:

1. Open Help > Show Log in Explorer/Finder
2. Look for log entries with prefixes:
   - `com.zps.zest.browser`
   - `WebBrowserService`
   - `JCEFBrowserManager`

## Future Enhancements

Planned improvements for future versions:

1. Tabbed browsing support
2. Browser developer tools integration
3. Enhanced JavaScript debugging capabilities
4. Expanded AI integration with more natural language patterns
5. Customizable browser settings

---

## Appendix: Implementation Reference

### Code Structure

```
com.zps.zest.browser/
├── actions/
│   ├── SendToBrowserAction.java
│   └── TestBrowserAction.java
├── BrowserIntegrationManager.java
├── BrowserIntegrator.java
├── BrowserTestHelper.java
├── JavaScriptBridge.java
├── JCEFBrowserManager.java
├── WebBrowserPanel.java
├── WebBrowserService.java
└── WebBrowserToolWindow.java
```

### Pattern Recognition for AI Commands

The browser feature recognizes the following patterns in AI conversations:

1. Show in browser pattern:
   ```
   (?i)\b(show|display|open)\s+(?:this|the|in|on)?\s*(?:result|code|content|output|page)?\s+(?:in|on)\s+(?:the)?\s*browser\b
   ```

2. Load URL pattern:
   ```
   (?i)\b(?:load|open|navigate|go\s+to)\s+(?:url|website|page|link)?\s*[:\s]\s*(https?://\S+)\b
   ```