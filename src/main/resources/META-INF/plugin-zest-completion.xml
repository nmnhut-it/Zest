<!-- Zest Inline Completion Plugin Extensions -->
<idea-plugin>
    <extensions defaultExtensionNs="com.intellij">
        <!-- Startup activity to initialize completion services -->
        <postStartupActivity implementation="com.zps.zest.completion.ZestCompletionStartupActivity"/>
        
        <!-- Editor factory listener for event handling -->
        <editorFactoryListener implementation="com.zps.zest.events.ZestEditorFactoryListener"/>
        
        <!-- Action promoter for priority handling -->
        <actionPromoter order="first" implementation="com.zps.zest.completion.actions.ZestActionPromoter"/>
        
        <!-- Project services -->
        <projectService serviceInterface="com.zps.zest.completion.ZestInlineCompletionService"
                        serviceImplementation="com.zps.zest.completion.ZestInlineCompletionService"/>
        
        <projectService serviceInterface="com.zps.zest.completion.behavior.ZestTabBehaviorManager"
                        serviceImplementation="com.zps.zest.completion.behavior.ZestTabBehaviorManager"/>
        
        <!-- Notification groups for completion feedback -->
        <notificationGroup id="com.zps.zest.completion.info"
                           displayType="BALLOON"
                           displayName="Zest Completion Info"/>
        
        <notificationGroup id="com.zps.zest.completion.warning"
                           displayType="STICKY_BALLOON"
                           displayName="Zest Completion Warning"/>
    </extensions>
    
    <!-- Inline Completion Actions -->
    <actions>
        <group id="Zest.InlineCompletion" text="Zest Inline Completion" 
               description="AI-powered inline code completion">
            
            <!-- Manual trigger action -->
            <action id="Zest.InlineCompletion.Trigger"
                    class="com.zps.zest.completion.actions.ZestTrigger"
                    text="Trigger Zest Completion"
                    description="Manually trigger inline completion at cursor position">
                <keyboard-shortcut first-keystroke="ctrl SPACE" keymap="$default"/>
                <keyboard-shortcut first-keystroke="alt SLASH" keymap="$default"/>
            </action>
            
            <!-- Tab accept action (smart TAB behavior) -->
            <action id="Zest.InlineCompletion.TabAccept"
                    class="com.zps.zest.completion.actions.ZestTabAccept"
                    text="Accept Completion (Tab)"
                    description="Accept completion using TAB key when appropriate">
                <keyboard-shortcut first-keystroke="TAB" keymap="$default"/>
            </action>
            
            <!-- Explicit accept action -->
            <action id="Zest.InlineCompletion.Accept"
                    class="com.zps.zest.completion.actions.ZestAccept"
                    text="Accept Completion"
                    description="Accept the full completion">
                <keyboard-shortcut first-keystroke="ctrl ENTER" keymap="$default"/>
            </action>
            
            <!-- Partial acceptance actions -->
            <action id="Zest.InlineCompletion.AcceptNextWord"
                    class="com.zps.zest.completion.actions.ZestAcceptNextWord"
                    text="Accept Next Word"
                    description="Accept only the next word of the completion">
                <keyboard-shortcut first-keystroke="ctrl RIGHT" keymap="$default"/>
            </action>
            
<!--            <action id="Zest.InlineCompletion.AcceptNextLine"-->
<!--                    class="com.zps.zest.completion.actions.ZestAcceptNextLine"-->
<!--                    text="Accept Next Line"-->
<!--                    description="Accept only the next line of the completion">-->
<!--                <keyboard-shortcut first-keystroke="ctrl TAB" keymap="$default"/>-->
<!--            </action>-->
            
            <!-- Cycling actions -->
            <action id="Zest.InlineCompletion.CycleNext"
                    class="com.zps.zest.completion.actions.ZestCycleNext"
                    text="Next Completion"
                    description="Show next completion suggestion">
                <keyboard-shortcut first-keystroke="alt DOWN" keymap="$default"/>
            </action>
            
            <action id="Zest.InlineCompletion.CyclePrevious"
                    class="com.zps.zest.completion.actions.ZestCyclePrevious"
                    text="Previous Completion"
                    description="Show previous completion suggestion">
                <keyboard-shortcut first-keystroke="alt UP" keymap="$default"/>
            </action>
            
            <!-- Dismiss action -->
            <action id="Zest.InlineCompletion.Dismiss"
                    class="com.zps.zest.completion.actions.ZestDismiss"
                    text="Dismiss Completion"
                    description="Hide the current completion">
                <keyboard-shortcut first-keystroke="ESCAPE" keymap="$default"/>
            </action>
            
            <!-- Debug timing action -->
            <action id="Zest.InlineCompletion.DebugTiming"
                    class="com.zps.zest.actions.ZestCompletionTimingDebugAction"
                    text="Show Completion Timing Debug"
                    description="Display detailed timing information for completions"/>
        </group>
        
        <!-- Add debug action to Tools menu -->
        <action id="Zest.ShowCompletionTimingDebug"
                class="com.zps.zest.actions.ZestCompletionTimingDebugAction"
                text="Zest Completion Timing Debug..."
                description="Show detailed timing breakdown for recent completions">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        <!-- Context menu group for completion actions -->
        <group id="Zest.InlineCompletionContextMenu">
            <reference id="Zest.InlineCompletion.Accept"/>
            <reference id="Zest.InlineCompletion.AcceptNextWord"/>
            <reference id="Zest.InlineCompletion.AcceptNextLine"/>
            <separator/>
            <reference id="Zest.InlineCompletion.CycleNext"/>
            <reference id="Zest.InlineCompletion.CyclePrevious"/>
            <separator/>
            <reference id="Zest.InlineCompletion.Dismiss"/>
        </group>
        
        <!-- Add debug action to Tools menu -->
        <action id="Zest.ShowCompletionTimingDebug"
                class="com.zps.zest.actions.ZestCompletionTimingDebugAction"
                text="Zest Completion Timing Debug..."
                description="Show detailed timing breakdown for recent completions">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
