<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.zps.Zest</id>
    <version>1.9.824</version>  <!-- Replace with your actual version -->

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Zest</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="nhutnm3@vng.com.vn" url="https://www.vng.com.vn">Zingplay Game Studio</vendor>
    <description><![CDATA[
<h2>Zest: Smarter Java Development with AI</h2>
<p><b>Zest</b> supercharges your IntelliJ workflow. Instantly generate JUnit tests, implement TODOs, and refactor for testability—all powered by AI. Enjoy one-click code reviews, auto-generated commit messages, and smart comments. Boost productivity, ship quality code, and let Zest handle the repetitive stuff so you can focus on building great software. Try Zest and make testing effortless.</p>
]]></description>
    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>

    <projectListeners>
        <listener class="com.zps.zest.RagManagerProjectListener"
                  topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </projectListeners>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Register the web browser tool window factory -->
        <toolWindow id="ZPS Chat"
                    anchor="right"
                    factoryClass="com.zps.zest.browser.WebBrowserToolWindow"
                    icon="AllIcons.General.Web"
                    canCloseContents="true"/>

        <!-- Register the test writing tool window factory -->
        <toolWindow id="Test Writing Assistant"
                    anchor="bottom"
                    factoryClass="com.zps.zest.testing.TestWritingToolWindowFactory"
                    icon="AllIcons.RunConfigurations.TestState.Run"
                    canCloseContents="true"
                    secondary="false"/>

        <!-- Register the refactoring tool window factory -->
        <toolWindow id="Refactoring for Testability"
                    anchor="bottom"
                    factoryClass="com.zps.zest.refactoring.RefactoringToolWindowFactory"
                    icon="AllIcons.Actions.RefactoringBulb"
                    canCloseContents="true"
                    secondary="false"/>

        <!-- Register notification group -->
        <notificationGroup id="Zest LLM" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>

        <!-- Register autocomplete service -->
<!--        <projectService serviceInterface="com.zps.zest.autocomplete.ZestAutocompleteService"-->
<!--                        serviceImplementation="com.zps.zest.autocomplete.ZestAutocompleteService"/>-->

        <!-- Zest Autocomplete v2 Service -->
        <projectService serviceInterface="com.zps.zest.autocompletion2.core.AutocompleteService"
                        serviceImplementation="com.zps.zest.autocompletion2.core.AutocompleteService"/>

        <!-- Zest Autocomplete v2 Settings -->
        <projectService serviceInterface="com.zps.zest.autocompletion2.settings.AutocompleteSettings"
                        serviceImplementation="com.zps.zest.autocompletion2.settings.AutocompleteSettings"/>

        <!-- Startup activity to initialize autocomplete service -->
        <postStartupActivity implementation="com.zps.zest.autocomplete.ZestAutocompleteProjectComponent"/>

        <!-- Zest Autocomplete v2 Startup -->
        <postStartupActivity implementation="com.zps.zest.autocompletion2.AutocompleteStartup"/>

    </extensions>
    <actions>
        <group id="ZestGroup" text="Zest" description="Zest AI-powered development tools" popup="true">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>

        <!-- CHAT ACTIONS GROUP -->

        <!-- Agent-based Test Writing (most discoverable) -->
        <action id="Zest.AgentBasedTestWritingAction"
                class="com.zps.zest.testing.AgentBasedTestWritingAction"
                text="Agent: Step-by-Step Test Writing"
                description="Use an AI agent to write comprehensive tests step-by-step, allowing fine-grained human interaction">
            <add-to-group group-id="ZestGroup" anchor="first"/>
        </action>
        <!-- Agent-based Refactoring -->
        <action id="Zest.AgentBasedRefactoringAction"
                class="com.zps.zest.refactoring.AgentBasedRefactoringAction"
                text="Agent: Step-by-Step Refactor for Testability"
                description="Use an AI agent to implement testability refactoring, allowing fine-grained human interaction">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.AgentBasedTestWritingAction"/>
        </action>
        <!-- One-click Write Test -->
        <action id="com.zps.zest.GenerateTestByLlm"
                class="com.zps.zest.GenerateTestByLlm"
                text="Agent: One-click Write Test"
                description="Write tests by LLMs">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.AgentBasedRefactoringAction"/>
        </action>
        <!-- Add Comment for This Class -->
        <action id="Zest.GenerateCodeCommentsAction"
                class="com.zps.zest.browser.actions.GenerateCodeCommentsAction"
                text="Agent: Write Comment for Selected Text"
                description="Add comment for this class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="com.zps.zest.GenerateTestByLlm"/>
        </action>
        <!-- Implement TODOs -->
        <action id="com.zps.zest.ImplementTodosAction"
                class="com.zps.zest.ImplementTodosAction"
                text="Implement Your TODOs"
                description="Implement TODOs in selected code using Ollama">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.GenerateCodeCommentsAction"/>
        </action>
        <!-- Review This Class -->
        <action id="Zest.SendCodeReviewToChatBox"
                class="com.zps.zest.browser.actions.SendCodeReviewToChatBox"
                text="Chat: Review This Class"
                description="Review this class in chat ZPS">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="com.zps.zest.ImplementTodosAction"/>
        </action>
        <!-- Refactor Advisory (Chat) -->
        <action id="Zest.RefactorForTestabilityAction"
                class="com.zps.zest.RefactorForTestabilityAction"
                text="Chat: Refactor Advisory for Testability"
                description="Give advice on how to refactor the selected code for testability of this class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.SendCodeReviewToChatBox"/>
        </action>
        <!-- Write Tests for This Class (Chat) -->
        <action id="Zest.SendPipelineToChatBox"
                class="com.zps.zest.browser.actions.SendTestPipelineToChatBox"
                text="Chat: Write Tests for This Class"
                description="Generate a test prompt and send it to chat box">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.RefactorForTestabilityAction"/>
        </action>
        <!-- Generate Git Commit Message (Chat) -->
        <action id="Zest.GitCommitMessageGeneratorAction"
                class="com.zps.zest.GitCommitMessageGeneratorAction"
                text="Chat: Generate Git Commit Message"
                description="Generate commit message based on git changes">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.SendPipelineToChatBox"/>
        </action>

        <!-- Developer Tools (kept in Tools menu) -->
        <action id="Zest.ToggleDevTools"
                class="com.zps.zest.browser.actions.ToggleDevToolsAction"
                text="Toggle ZPS Chat Developer Tools"
                description="Toggle the visibility of developer tools in ZPS Chat">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Autocomplete Actions (TAB key handling) -->
<!--        <action id="Zest.AcceptCompletion"-->
<!--                class="com.zps.zest.autocomplete.actions.AcceptCompletionAction"-->
<!--                text="Accept Autocomplete Suggestion"-->
<!--                description="Accept the current autocomplete suggestion">-->
<!--        </action>-->

        <!-- Smart Tab Completion: word -> line -> full (handled by EditorActionHandler) -->
<!--        <action id="Zest.AcceptWordCompletion"-->
<!--                class="com.zps.zest.autocomplete.actions.AcceptWordCompletionAction"-->
<!--                text="Smart Tab Completion"  -->
<!--                description="Smart tab completion: first tab = word, second = line, third+ = full">-->
<!--            &lt;!&ndash; No keyboard shortcut - handled by ZestSmartTabHandler &ndash;&gt;-->
<!--        </action>-->

        <!-- Keep line completion action for explicit use -->
<!--        <action id="Zest.AcceptLineCompletion"-->
<!--                class="com.zps.zest.autocomplete.actions.AcceptLineCompletionAction"-->
<!--                text="Accept Next Line"-->
<!--                description="Accept the next line from the autocomplete suggestion">-->
<!--        </action>-->

<!--        <action id="Zest.RejectCompletion"-->
<!--                class="com.zps.zest.autocomplete.actions.RejectCompletionAction"-->
<!--                text="Reject Autocomplete Suggestion"-->
<!--                description="Reject the current autocomplete suggestion">-->
<!--            <keyboard-shortcut keymap="$default" first-keystroke="ESCAPE"/>-->
<!--        </action>-->

        <!-- Test action for debugging autocomplete -->
<!--        <action id="Zest.TestAutocomplete"-->
<!--                class="com.zps.zest.autocomplete.actions.TestAutocompleteAction"-->
<!--                text="Test Autocomplete Service"-->
<!--                description="Test the autocomplete service (debug only)">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

<!--        &lt;!&ndash; Smart completion test action &ndash;&gt;-->
<!--        <action id="Zest.TestSmartCompletion"-->
<!--                class="com.zps.zest.autocomplete.actions.TestSmartCompletionAction"-->
<!--                text="Test Smart Tab Completion"-->
<!--                description="Trigger autocomplete to test smart tab completion behavior">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

        <!-- Test TAB handler installation -->
<!--        <action id="Zest.TestTabHandler"-->
<!--                class="com.zps.zest.autocomplete.actions.TestTabHandlerAction"-->
<!--                text="Test TAB Handler Installation"-->
<!--                description="Test if the ZestSmartTabHandler is properly installed">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

        <!-- Diagnose Tab completion issues -->
<!--        <action id="Zest.DiagnoseTabIssue"-->
<!--                class="com.zps.zest.autocomplete.actions.DiagnoseTabIssueAction"-->
<!--                text="🔧 Diagnose Tab Completion Issue"-->
<!--                description="Diagnose and fix Tab completion cancellation issues">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

<!--        &lt;!&ndash; Test trigger completion &ndash;&gt;-->
<!--        <action id="Zest.TestTriggerCompletion"-->
<!--                class="com.zps.zest.autocomplete.actions.TestTabCompletionAction"-->
<!--                text="🧪 Trigger Test Completion"-->
<!--                description="Force trigger completion to test Tab key behavior">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

        <!-- Force reinstall Tab handler -->
<!--        <action id="Zest.ForceReinstallTabHandler"-->
<!--                class="com.zps.zest.autocomplete.actions.ForceReinstallTabHandlerAction"-->
<!--                text="🔄 Force Reinstall Tab Handler"-->
<!--                description="Force reinstall ZestSmartTabHandler to fix conflicts">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

<!--        &lt;!&ndash; Demo Tab issue simulation &ndash;&gt;-->
<!--        <action id="Zest.SimulateTabIssueDemo"-->
<!--                class="com.zps.zest.autocomplete.actions.SimulateTabIssueDemoAction"-->
<!--                text="🎭 Demo Tab Issue Simulation"-->
<!--                description="Simulate and demonstrate the Tab completion issue">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

        <!-- Test progressive Tab acceptance -->
<!--        <action id="Zest.TestProgressiveTab"-->
<!--                class="com.zps.zest.autocomplete.actions.TestProgressiveTabAction"-->
<!--                text="🔄 Test Progressive Tab Acceptance"-->
<!--                description="Test word → line → full Tab progression">-->
<!--            <add-to-group group-id="ZestGroup" anchor="last"/>-->
<!--        </action>-->

        <!-- AUTOCOMPLETE v2 ACTIONS -->
        <group id="ZestAutocompleteV2Group" text="Autocomplete v2 (New)" description="Zest Autocomplete v2 - Clean Implementation" popup="true">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </group>

        <!-- v2 Diagnostic -->
        <action id="Zest.V2.Diagnostic"
                class="com.zps.zest.autocompletion2.debug.TestActions$DiagnosticAction"
                text="🔍 Autocomplete v2 Diagnostic"
                description="Show diagnostic information for Zest Autocomplete v2">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="first"/>
        </action>

        <!-- v2 Create Test Completion -->
        <action id="Zest.V2.CreateTest"
                class="com.zps.zest.autocompletion2.debug.TestActions$CreateTestCompletionAction"
                text="🧪 Create Test Completion"
                description="Create a test completion to verify Tab functionality">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="after" relative-to-action="Zest.V2.Diagnostic"/>
        </action>

        <!-- v2 Trigger LLM Completion -->
        <action id="Zest.V2.TriggerLLM"
                class="com.zps.zest.autocompletion2.debug.TestActions$TriggerLLMCompletionAction"
                text="🤖 Trigger LLM Completion"
                description="Trigger real LLM completion from API">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="after" relative-to-action="Zest.V2.CreateTest"/>
        </action>

        <!-- v2 Progressive Demo -->
        <action id="Zest.V2.ProgressiveDemo"
                class="com.zps.zest.autocompletion2.debug.TestActions$ProgressiveDemoAction"
                text="🔄 Progressive Tab Demo"
                description="Demonstrate progressive Tab acceptance (word → line → full)">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="after" relative-to-action="Zest.V2.TriggerLLM"/>
        </action>

        <!-- v2 Install Tab Handler -->
        <action id="Zest.V2.InstallTabHandler"
                class="com.zps.zest.autocompletion2.debug.TestActions$InstallTabHandlerAction"
                text="⚙️ Install Tab Handler"
                description="Install or reinstall the Tab handler for Zest Autocomplete v2">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="after" relative-to-action="Zest.V2.ProgressiveDemo"/>
        </action>

        <!-- v2 Debug Logger -->
        <action id="Zest.V2.DebugLog"
                class="com.zps.zest.autocompletion2.debug.TestActions$DebugLogAction"
                text="📝 Log Debug Info"
                description="Log detailed debug information to console">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="after" relative-to-action="Zest.V2.InstallTabHandler"/>
        </action>

        <!-- v2 Toggle Auto-Completion -->
        <action id="Zest.V2.ToggleAutoCompletion"
                class="com.zps.zest.autocompletion2.debug.TestActions$ToggleAutoCompletionAction"
                text="🔄 Toggle Auto-Completion"
                description="Enable/disable automatic LLM completion triggering">
            <add-to-group group-id="ZestAutocompleteV2Group" anchor="after" relative-to-action="Zest.V2.DebugLog"/>
        </action>
    </actions>
</idea-plugin>
