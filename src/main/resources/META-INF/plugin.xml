<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.zps.Zest</id>
    <version>1.9.824</version>  <!-- Replace with your actual version -->

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Zest</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="nhutnm3@vng.com.vn" url="https://www.vng.com.vn">Zingplay Game Studio</vendor>
    <description><![CDATA[
<h2>Zest: Smarter Java Development with AI</h2>
<p><b>Zest</b> supercharges your IntelliJ workflow. Instantly generate JUnit tests, implement TODOs, and refactor for testabilityâ€”all powered by AI. Enjoy one-click code reviews, auto-generated commit messages, and smart comments. Boost productivity, ship quality code, and let Zest handle the repetitive stuff so you can focus on building great software. Try Zest and make testing effortless.</p>
]]></description>
    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>

    <projectListeners>
        <listener class="com.zps.zest.RagManagerProjectListener"
                  topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </projectListeners>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Register the web browser tool window factory -->
        <toolWindow id="ZPS Chat"
                    anchor="right"
                    factoryClass="com.zps.zest.browser.WebBrowserToolWindow"
                    icon="AllIcons.General.Web"
                    canCloseContents="true"/>

        <!-- Register the test writing tool window factory -->
        <toolWindow id="Test Writing Assistant"
                    anchor="bottom"
                    factoryClass="com.zps.zest.testing.TestWritingToolWindowFactory"
                    icon="AllIcons.RunConfigurations.TestState.Run"
                    canCloseContents="true"
                    secondary="false"/>

        <!-- Register the refactoring tool window factory -->
        <toolWindow id="Refactoring for Testability"
                    anchor="bottom"
                    factoryClass="com.zps.zest.refactoring.RefactoringToolWindowFactory"
                    icon="AllIcons.Actions.RefactoringBulb"
                    canCloseContents="true"
                    secondary="false"/>

        <!-- Register notification group -->
        <notificationGroup id="Zest LLM" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>

        <!-- Register autocomplete service -->
        <projectService serviceInterface="com.zps.zest.autocomplete.ZestAutocompleteService"
                        serviceImplementation="com.zps.zest.autocomplete.ZestAutocompleteService"/>

        <!-- Startup activity to initialize autocomplete service -->
        <postStartupActivity implementation="com.zps.zest.autocomplete.ZestAutocompleteProjectComponent"/>

    </extensions>
    <actions>
        <group id="ZestGroup" text="Zest" description="Zest AI-powered development tools" popup="true">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>

        <!-- CHAT ACTIONS GROUP -->

        <!-- Agent-based Test Writing (most discoverable) -->
        <action id="Zest.AgentBasedTestWritingAction"
                class="com.zps.zest.testing.AgentBasedTestWritingAction"
                text="Agent: Step-by-Step Test Writing"
                description="Use an AI agent to write comprehensive tests step-by-step, allowing fine-grained human interaction">
            <add-to-group group-id="ZestGroup" anchor="first"/>
        </action>
        <!-- Agent-based Refactoring -->
        <action id="Zest.AgentBasedRefactoringAction"
                class="com.zps.zest.refactoring.AgentBasedRefactoringAction"
                text="Agent: Step-by-Step Refactor for Testability"
                description="Use an AI agent to implement testability refactoring, allowing fine-grained human interaction">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.AgentBasedTestWritingAction"/>
        </action>
        <!-- One-click Write Test -->
        <action id="com.zps.zest.GenerateTestByLlm"
                class="com.zps.zest.GenerateTestByLlm"
                text="Agent: One-click Write Test"
                description="Write tests by LLMs">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.AgentBasedRefactoringAction"/>
        </action>
        <!-- Add Comment for This Class -->
        <action id="Zest.GenerateCodeCommentsAction"
                class="com.zps.zest.browser.actions.GenerateCodeCommentsAction"
                text="Agent: Write Comment for Selected Text"
                description="Add comment for this class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="com.zps.zest.GenerateTestByLlm"/>
        </action>
        <!-- Implement TODOs -->
        <action id="com.zps.zest.ImplementTodosAction"
                class="com.zps.zest.ImplementTodosAction"
                text="Implement Your TODOs"
                description="Implement TODOs in selected code using Ollama">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.GenerateCodeCommentsAction"/>
        </action>
        <!-- Review This Class -->
        <action id="Zest.SendCodeReviewToChatBox"
                class="com.zps.zest.browser.actions.SendCodeReviewToChatBox"
                text="Chat: Review This Class"
                description="Review this class in chat ZPS">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="com.zps.zest.ImplementTodosAction"/>
        </action>
        <!-- Refactor Advisory (Chat) -->
        <action id="Zest.RefactorForTestabilityAction"
                class="com.zps.zest.RefactorForTestabilityAction"
                text="Chat: Refactor Advisory for Testability"
                description="Give advice on how to refactor the selected code for testability of this class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.SendCodeReviewToChatBox"/>
        </action>
        <!-- Write Tests for This Class (Chat) -->
        <action id="Zest.SendPipelineToChatBox"
                class="com.zps.zest.browser.actions.SendTestPipelineToChatBox"
                text="Chat: Write Tests for This Class"
                description="Generate a test prompt and send it to chat box">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.RefactorForTestabilityAction"/>
        </action>
        <!-- Generate Git Commit Message (Chat) -->
        <action id="Zest.GitCommitMessageGeneratorAction"
                class="com.zps.zest.GitCommitMessageGeneratorAction"
                text="Chat: Generate Git Commit Message"
                description="Generate commit message based on git changes">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.SendPipelineToChatBox"/>
        </action>

        <!-- Developer Tools (kept in Tools menu) -->
        <action id="Zest.ToggleDevTools"
                class="com.zps.zest.browser.actions.ToggleDevToolsAction"
                text="Toggle ZPS Chat Developer Tools"
                description="Toggle the visibility of developer tools in ZPS Chat">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Autocomplete Actions (hidden from menus, triggered by keyboard shortcuts) -->
        <action id="Zest.AcceptCompletion"
                class="com.zps.zest.autocomplete.actions.AcceptCompletionAction"
                text="Accept Autocomplete Suggestion"
                description="Accept the current autocomplete suggestion">
        </action>

        <!-- Partial Acceptance Actions -->
        <action id="Zest.AcceptWordCompletion"
                class="com.zps.zest.autocomplete.actions.AcceptWordCompletionAction"
                text="Accept Next Word"
                description="Accept the next word from the autocomplete suggestion">
            <keyboard-shortcut keymap="$default" first-keystroke="TAB"/>
        </action>

        <action id="Zest.AcceptLineCompletion"
                class="com.zps.zest.autocomplete.actions.AcceptLineCompletionAction"
                text="Accept Next Line"
                description="Accept the next line from the autocomplete suggestion">
        </action>

        <action id="Zest.RejectCompletion"
                class="com.zps.zest.autocomplete.actions.RejectCompletionAction"
                text="Reject Autocomplete Suggestion"
                description="Reject the current autocomplete suggestion">
            <keyboard-shortcut keymap="$default" first-keystroke="ESCAPE"/>
        </action>

        <!-- Test action for debugging autocomplete -->
        <action id="Zest.TestAutocomplete"
                class="com.zps.zest.autocomplete.actions.TestAutocompleteAction"
                text="Test Autocomplete Service"
                description="Test the autocomplete service (debug only)">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
