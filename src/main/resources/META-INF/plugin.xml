<idea-plugin>
    <!-- Plugin name displayed in the IDE -->
    <!-- Read more: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Zest</name>
    
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.zps.Zest</id>
    
    <!-- Plugin version -->
    <version>1.9.908</version>

    <!-- Vendor information -->
    <vendor email="nhutnm3@vng.com.vn" url="https://www.vng.com.vn">Zingplay Game Studio</vendor>
    <!-- Plugin description -->
    <description><![CDATA[
   <h2>Zest: Smarter Java Development with AI</h2>
   <p><b>Zest</b> supercharges your IntelliJ workflow. Instantly generate JUnit tests, implement TODOs, and refactor for testability—all powered by AI. Enjoy one-click code reviews, auto-generated commit messages, and smart comments. Boost productivity, ship quality code, and let Zest handle the repetitive stuff so you can focus on building great software. Try Zest and make testing effortless.</p>]]></description>
    
    <!-- Compatibility version range -->
    <!-- Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>
    <idea-version since-build="223.0" until-build="259.*"/>
    
    <projectListeners>


        <listener class="com.zps.zest.inlinechat.JCefInitializer"
                  topic="com.intellij.openapi.startup.ProjectActivity"/>
    </projectListeners>
    
    <!-- Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Application-level service for global settings -->
        <applicationService serviceImplementation="com.zps.zest.settings.ZestGlobalSettings"/>
        
        <!-- Project-level service for project-specific settings -->
        <projectService serviceImplementation="com.zps.zest.settings.ZestProjectSettings"/>
        <!-- Using backgroundPostStartupActivity for better performance -->
        <backgroundPostStartupActivity implementation="com.zps.zest.completion.ZestCompletionStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.codehealth.CodeGuardianStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.settings.SettingsMigrationNotice"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.startup.PromptMigrationStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.mcp.ToolApiServerStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.update.VersionUpdateNotifier"/>
        <editorFactoryListener implementation="com.zps.zest.events.ZestEditorFactoryListener"/>
        <actionPromoter order="first" implementation="com.zps.zest.completion.actions.ZestActionPromoter"/>

                    

            
        <projectConfigurable
                groupId="tools"
                instance="com.zps.zest.settings.ZestSettingsConfigurable"
                displayName="Zest Plugin"
                id="zest.settings"
                nonDefaultProject="true"/>

                
        <projectConfigurable
                instance="com.zps.zest.codehealth.CodeHealthConfigurable"
                displayName="Code Health"
                id="zest.codeguardian"
                parentId="zest.settings"
                nonDefaultProject="true"/>

        <notificationGroup id="Zest LLM" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>
        <notificationGroup id="Code Health" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>
        <notificationGroup id="Zest Completion Debug" displayType="BALLOON" isLogByDefault="false"/>
        <notificationGroup id="Zest Updates" displayType="BALLOON" isLogByDefault="false"/>


        <!-- Status Bar Widgets -->
        <statusBarWidgetFactory id="ZestCompletionStatus" 
                               implementation="com.zps.zest.completion.ui.ZestCompletionStatusBarWidgetFactory" 
                               order="last"/>
        <statusBarWidgetFactory id="CodeHealthStatusBarWidget" 
                               implementation="com.zps.zest.codehealth.ui.CodeGuardianStatusBarWidgetFactory" 
                               order="last"/>

        
        <!-- Code Health Notification Group -->
        <notificationGroup id="Zest Code Health" displayType="BALLOON" isLogByDefault="false"/>
        
        <!-- Code Health Editor Provider -->
        <fileEditorProvider implementation="com.zps.zest.codehealth.ui.editor.CodeHealthEditorProvider"/>
        

        
        <!-- Zest Chat Editor Provider -->
        <fileEditorProvider implementation="com.zps.zest.browser.editor.ZestChatEditorProvider"/>
        
        <!-- Test Generation Editor Provider -->
        <fileEditorProvider implementation="com.zps.zest.testgen.ui.TestGenerationFileEditorProvider"/>
        

        <!-- LangChain4j Services for agentic retrieval and AI task management -->
        <projectService serviceImplementation="com.zps.zest.langchain4j.ZestLangChain4jService"/>
        <projectService serviceImplementation="com.zps.zest.langchain4j.naive_service.NaiveStreamingLLMService"/>
        <projectService serviceImplementation="com.zps.zest.retrieval.core.EmbeddingService"/>
        
        <!-- Test Generation Service -->
        <projectService serviceImplementation="com.zps.zest.testgen.StateMachineTestGenerationService"/>
        
        <!-- Chat UI Service -->
        <projectService serviceImplementation="com.zps.zest.chatui.ChatUIService"/>

        <!-- Browser Services -->
        <projectService serviceImplementation="com.zps.zest.browser.JCEFBrowserService"/>

        <!-- Tool API Server Service -->
        <projectService serviceImplementation="com.zps.zest.mcp.ToolApiServerService"/>
        
        <!-- Inline Completion Services -->
        <projectService serviceImplementation="com.zps.zest.completion.ZestInlineCompletionService"/>
    </extensions>
    
    <actions>
        <group id="Zest.InlineCompletion" text="Zest Inline Completion">
            <action id="Zest.InlineCompletion.Trigger"
                    class="com.zps.zest.completion.actions.ZestTrigger"
                    text="Trigger Inline Completion / Gợi ý code thông minh"
                    description="Trigger smart code suggestions at cursor position / Gợi ý code thông minh tại vị trí con trỏ">
                <keyboard-shortcut first-keystroke="ctrl alt SPACE" keymap="$default"/>

            </action>

            <action id="Zest.InlineCompletion.TabAccept"
                    class="com.zps.zest.completion.actions.ZestTabAccept"
                    text="Accept Completion (Tab) / Chấp nhận gợi ý (Tab)"
                    description="Accept suggestion with Tab key / Chấp nhận gợi ý bằng phím Tab">
                <keyboard-shortcut first-keystroke="TAB" keymap="$default"/>
            </action>

            <!-- Temporarily disabled - needs reimplementation
            <action id="Zest.InlineCompletion.Accept"
                    class="com.zps.zest.completion.actions.ZestAccept"
                    text="Accept Completion"
                    description="Chấp nhận gợi ý bằng Ctrl+Tab">
                <keyboard-shortcut first-keystroke="ctrl TAB" keymap="$default"/>
            </action>
            -->

            <!-- Temporarily disabled - needs reimplementation
            <action id="Zest.InlineCompletion.CycleNext"
                    class="com.zps.zest.completion.actions.ZestCycleNext"
                    text="Cycle Next Completion"
                    description="Xem gợi ý tiếp theo (Alt+Down)">
                <keyboard-shortcut first-keystroke="alt DOWN" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.CyclePrevious"
                    class="com.zps.zest.completion.actions.ZestCyclePrevious"
                    text="Cycle Previous Completion"
                    description="Xem gợi ý trước đó (Alt+Up)">
                <keyboard-shortcut first-keystroke="alt UP" keymap="$default"/>
            </action>
            -->

            <action id="Zest.InlineCompletion.Dismiss"
                    class="com.zps.zest.completion.actions.ZestDismiss"
                    text="Dismiss Completion / Hủy bỏ gợi ý"
                    description="Cancel suggestion with Escape / Hủy gợi ý bằng phím Escape">
                <keyboard-shortcut first-keystroke="ESCAPE" keymap="$default"/>
            </action>

            <action id="Zest.TriggerQuickAction"
                    class="com.zps.zest.completion.actions.ZestTriggerQuickAction"
                    text="Quick Action... / Thao tác nhanh..."
                    description="Perform specific task on selected code / Thực hiện tác vụ cụ thể trên code đã chọn">
                <keyboard-shortcut first-keystroke="ctrl SPACE" keymap="$default"/>
                <keyboard-shortcut first-keystroke="ctrl SPACE" keymap="Mac OS X"/>
                <keyboard-shortcut first-keystroke="ctrl SPACE" keymap="Mac OS X 10.5+"/>
            </action>

            <action id="Zest.TriggerQuickActionBrowser"
                    class="com.zps.zest.completion.actions.ZestTriggerQuickActionBrowser"
                    text="Quick Action (Browser)... / Thao tác nhanh (Trình duyệt)..."
                    description="Open quick action menu with OpenWebUI browser chat / Mở menu thao tác nhanh với chat trình duyệt OpenWebUI">
                <keyboard-shortcut first-keystroke="alt shift B" keymap="$default"/>
            </action>
        </group>

        <group id="ZestGroup" text="Zest" description="AI-powered tools for development / Công cụ AI hỗ trợ lập trình" popup="true"
               icon="com.zps.zest.ZestIcons.ZEST">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>
        
        <!-- Simple Chat Dialog Action -->
<!--        <action id="Zest.OpenSimpleChat"-->
<!--                class="com.zps.zest.chatui.OpenChatDialogAction"-->
<!--                text="💬 Open Chat - Simple / Mở hộp thoại chat trong Intelij"-->
<!--                description="Open simple chat dialog for AI assistance / Mở hộp thoại chat đơn giản với AI">-->
<!--            <add-to-group group-id="ZestGroup" anchor="first"/>-->
<!--        </action>-->
        
        <!-- Open Chat in Editor Action -->
        <action id="Zest.OpenChatInEditor"
                class="com.zps.zest.browser.actions.OpenChatInEditorAction"
                text="Open Chat / Mở chat toàn màn hình"
                description="Open ZPS Chat in full-screen editor tab / Mở chat AI trong tab toàn màn hình">
            <add-to-group group-id="ZestGroup" anchor="first"/>
        </action>



        <!-- Toolbar Actions -->
        <action id="Zest.OpenChat"
                class="com.zps.zest.browser.actions.OpenZestChatAction"
                text="Chat / Trò chuyện với AI"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT"
                description="Open ZPS AI Chat / Mở cửa sổ trò chuyện với AI">
            <add-to-group group-id="MainToolbarRight" anchor="last"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift C"/>
        </action>

        <action id="Zest.OpenCodeHealth"
                class="com.zps.zest.codehealth.actions.OpenCodeHealthAction"
                text="Health / Kiểm tra sức khỏe code"
                icon="com.zps.zest.ZestIcons.CODE_HEALTH"
                description="Open Code Health Overview / Mở bảng kiểm tra chất lượng code">
            <add-to-group group-id="MainToolbarRight" anchor="after" relative-to-action="Zest.OpenChat"/>
        </action>

        <action id="Zest.SendCodeReviewToChatBox"
                class="com.zps.zest.browser.actions.SendCodeReviewToChatBox"
                text="Code Review (Chat) / Nhờ AI xem code"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"
                description="AI reviews and suggests improvements / AI xem xét code và đưa ra gợi ý cải thiện">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="Zest.ReviewCurrentFile"/>
        </action>

        <action id="Zest.GitCommitMessageGeneratorAction"
                class="com.zps.zest.GitCommitMessageGeneratorAction"
                text="Git Commit and Push / Lưu và đẩy code lên Git"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"
                description="Open Git UI with AI-generated commit message / Mở giao diện Git với AI tự động viết mô tả commit">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>



        <!-- Removed Start Tools action - proxy server is now controlled via settings -->
        
        <!-- Test Generation Action -->
        <action id="Zest.GenerateTests"
                class="com.zps.zest.testgen.actions.GenerateTestAction"
                text="Generate Tests (AI) / Tạo test tự động"
                icon="com.zps.zest.ZestIcons.TEST_WRITING_16"
                description="Generate tests using AI agents / Dùng AI để viết test cho code của bạn">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="Generate"/>
            <keyboard-shortcut first-keystroke="ctrl alt T" keymap="$default"/>
        </action>

        <!-- Test Generation Help Action -->
        <action id="Zest.ShowTestGenerationHelp"
                class="com.zps.zest.testgen.actions.ShowTestGenerationHelpAction"
                icon="AllIcons.Actions.MoveToWindow"
                text="Test Generation Guide / Hướng dẫn tạo test"
                description="View comprehensive test generation documentation / Xem tài liệu chi tiết về tạo test">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.GenerateTests"/>
        </action>
        
        <!-- Code Health Group -->
        <group id="Zest.CodeHealth" text="Code Health / Sức khỏe code" popup="true">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <!-- Removed from ToolsMenu - available in ZestGroup -->
            
            <!-- Removed non-functional "Activate Code Health" action -->
            
<!--            <action id="Zest.AddMethodAtCaret"-->
<!--                    class="com.zps.zest.codehealth.actions.AddMethodAtCaretAction"-->
<!--                    text="🎯 Track This Method / Theo Dõi Method Này"-->
<!--                    description="Add method to quality monitoring queue / Thêm method vào hàng đợi giám sát chất lượng">-->
<!--            </action>-->
            
<!--            <action id="Zest.TriggerBackgroundReview"-->
<!--                    class="com.zps.zest.codehealth.actions.TriggerBackgroundReviewAction"-->
<!--                    text="🔄 Process Review Queue / Xử Lý Hàng Đợi"-->
<!--                    description="Review all pending methods in background / Đánh giá các method đang chờ">-->
<!--            </action>-->

            <action id="Zest.ReviewCurrentFile"
                    class="com.zps.zest.codehealth.actions.ReviewCurrentFileAction"
                    text="Review This File Now / Kiểm tra file ngay"
                    description="Immediately analyze current file / Phân tích ngay file hiện tại">
                <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="Zest.GenerateTests"/>
                <keyboard-shortcut first-keystroke="ctrl alt H" keymap="$default"/>
            </action>
            
            <action id="Zest.TriggerFinalReview"
                    class="com.zps.zest.codehealth.actions.TriggerFinalReviewAction"
                    text="📊 Daily Health Report / Báo cáo chất lượng hàng ngày"
                    description="Generate comprehensive daily report / Tạo báo cáo tổng hợp chất lượng code hàng ngày">
            </action>
            <action id="Zest.ShowGuardianHelp"
                    class="com.zps.zest.codehealth.actions.ShowGuardianHelpAction"
                    text="Usage Guide / Hướng dẫn sử dụng"
                    description="View Code Health usage guide / Xem hướng dẫn sử dụng kiểm tra sức khỏe code">
            </action>
        </group>

        <!-- Ripgrep Tool Testing Action -->
        <action id="Zest.TestRipgrepTool"
                class="com.zps.zest.explanation.tools.testing.TestRipgrepToolAction"
                text="Test Ripgrep Tool / Kiểm tra công cụ tìm kiếm"
                description="Open manual testing dialog / Mở hộp thoại kiểm thử công cụ tìm kiếm code">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="CodeMenu" anchor="last"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift F12"/>
        </action>

        <!-- Code Context Agent Testing Action -->
        <action id="Zest.TestCodeContext"
                class="com.zps.zest.context.ui.TestCodeContextAction"
                text="Test Code Context Agent / Kiểm tra tìm hiểu ngữ cảnh code"
                description="Open test dialog for Code Context Agent / Mở hộp thoại thử nghiệm tìm hiểu code">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Metrics Testing Action -->
        <action id="Zest.TestMetrics"
                class="com.zps.zest.completion.metrics.testing.ui.TestMetricsAction"
                text="Test Metrics System / Kiểm tra hệ thống metrics"
                description="Open test dialog for Metrics System / Mở hộp thoại thử nghiệm metrics">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- View Metrics Session Log Action -->
        <action id="Zest.ViewMetricsSession"
                class="com.zps.zest.completion.metrics.testing.ui.ViewMetricsSessionAction"
                text="View Metrics Session Log / Xem log session metrics"
                description="View complete session log of all metrics events / Xem log đầy đủ tất cả sự kiện metrics">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Code Health Debug Actions Group -->
        <group id="Zest.CodeHealthDebug" text="Debug Tools / Công cụ gỡ lỗi" popup="true">
<!--            <add-to-group group-id="Zest.CodeHealth" anchor="last"/>-->

            <action id="Zest.ShowReviewQueueStatus"
                    class="com.zps.zest.codehealth.actions.ShowReviewQueueStatusAction"
                    text="Review Queue Status / Xem danh sách chờ kiểm tra"
                    description="View methods being monitored / Xem các phương thức đang được theo dõi">
            </action>
            
            <action id="Zest.DebugHealthAction"
                    class="com.zps.zest.codehealth.DebugHealthAction"
                    text="Test Mode / Chế độ thử nghiệm"
                    description="Reset and add test data / Đặt lại và thêm dữ liệu thử nghiệm">
            </action>
            
            <separator/>
            

        </group>
        
        <!-- Moved debug actions to a debug submenu -->
        
        <!-- Zest Rules Management Action -->
        <action id="Zest.CreateRulesFile"
                class="com.zps.zest.actions.CreateZestRulesAction"
                text="Create/Open Zest Rules File / Tạo/Mở file quy tắc"
                description="Create or open custom rules file / Tạo hoặc mở file định nghĩa quy tắc riêng cho AI">
            <add-to-group group-id="ZestGroup" anchor="first"/>
        </action>
        
        <!-- Open Chat in Editor (also in Tools menu) -->
        <action id="Zest.OpenChatInEditorTools"
                class="com.zps.zest.browser.actions.OpenChatInEditorAction"
                text="ZPS Chat (Editor) / Chat toàn màn hình"
                description="Open ZPS Chat in full-screen editor tab / Mở chat AI ở chế độ toàn màn hình">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Tool-Enabled Chat Action -->
        <action id="Zest.OpenToolEnabledChat"
                class="com.zps.zest.browser.actions.OpenToolEnabledChatAction"
                text="Chat with Tools / Chat với công cụ mạnh"
                description="Open chat with code exploration tools / Mở chat với khả năng tìm kiếm và phân tích code">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        <!-- Zest Update Info Action -->
        <action id="Zest.ShowUpdateInfo"
                class="com.zps.zest.update.ShowUpdateInfoAction"
                text="Check for Zest Updates... / Kiểm tra cập nhật"
                description="Show update information / Hiển thị thông tin và tùy chọn tải bản mới">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        
        <!-- Zest Debug Menu (only in Tools menu) -->
        <group id="Zest.DebugMenu" text="Zest Debug / Gỡ lỗi Zest" popup="true">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            
            <action id="Zest.ShowCompletionTimingDebug"
                    class="com.zps.zest.actions.ZestCompletionTimingDebugAction"
                    text="Completion Timing Debug... / Kiểm tra tốc độ gợi ý"
                    description="Show timing breakdown / Hiển thị phân tích thời gian gợi ý code"/>
            
            <!-- Temporarily disabled - debug action removed
            <action id="Zest.ToggleCompletionDebug"
                    class="com.zps.zest.actions.ToggleCompletionDebugAction"
                    text="Toggle Completion Debug Logging"
                    description="Enable/disable verbose debug logging for completion"/>
            -->
            
            <action id="Zest.ToggleDevTools"
                    class="com.zps.zest.browser.actions.ToggleDevToolsAction"
                    text="Toggle Browser DevTools / Bật/tắt công cụ debug"
                    description="Toggle developer tools / Bật/tắt công cụ debug trình duyệt chat"/>
                    

        </group>
    </actions>

    <!-- Change notes for version updates -->
    <change-notes><![CDATA[
        <h3>Version 1.9.908</h3>
        <ul>
            <li><b>🔧 Git UI Dialog:</b> "Open Git UI" in quick action now opens separate dialog (like "Commit and push all") instead of using main browser panel</li>
            <li><b>📋 Tool Call Format:</b> Enforced "Tool calls so far: X/5" BEFORE every tool call with clear examples and double accountability (before + after)</li>
            <li><b>📦 Import Handling:</b> Added guidance for AI to check imports with searchCode and use fully qualified names when needed</li>
            <li><b>🎯 Exact File Search:</b> searchCode now handles specific file paths (e.g., "src/main/java/Service.java") with fallback to glob patterns</li>
            <li><b>📄 Context Lines Fixed:</b> before/after context lines now properly parsed and displayed from ripgrep JSON output</li>
            <li><b>🔄 Multiline Regex:</b> Added explicit multiline parameter for cross-line pattern matching (e.g., "private void.*?\\}") - AI has full control</li>
            <li><b>🪟 Tool Details Modal:</b> Replaced blocking alert() with beautiful modal for tool call details - scrollable, copyable, syntax-highlighted</li>
            <li><b>✅ Fixed replaceCodeInFile:</b> Tool response now shows NEW code after user accepts (was showing old code due to async timing issue)</li>
        </ul>

        <h3>Version 1.9.907</h3>
        <ul>
            <li><b>🚫 Binary File Exclusion:</b> Images, JARs, executables, and other binary files automatically excluded from AI commit message generation - clearer what AI analyzes</li>
            <li><b>📊 Full Transparency:</b> Git UI shows file breakdown (code vs binary), size estimates with exclusions, and exactly what files AI analyzed in status messages</li>
            <li><b>⚡ Performance Boost:</b> Git status cached for 3s (instant on rapid refreshes), debounced size estimation (300ms), auto-refresh after commit with proper timing</li>
            <li><b>🎯 Large Changeset Handling:</b> AI receives special instruction for >50KB changes to prioritize and summarize effectively - users see "Large changeset" warning</li>
            <li><b>💬 Chat UI Fixes:</b> Fixed non-streaming mode tool visibility with smart refresh (only when memory changes), preserved scroll position during updates</li>
            <li><b>🔧 Quick Action Polish:</b> Renamed misleading "Commit and push all" to honest "Open Git UI"</li>
        </ul>

        <h3>Version 1.9.906</h3>
        <ul>
            <li><b>🧠 Smart Code Completion:</b> Enhanced "Fill code at cursor" with PSI-based context analysis - AI now knows available methods, variables, types, and imports for much better suggestions</li>
            <li><b>🎯 Intent Detection:</b> Automatically detects what you're trying to do (method call arguments, variable assignment, return statement, etc.) for context-aware completions</li>
            <li><b>📏 Massive Context:</b> Increased from 10 to 100 lines before/after cursor - AI sees entire class/file for better pattern understanding</li>
            <li><b>🔄 Regenerate Feature:</b> Press R in completion dialog to get new options if first batch isn't good - no need to restart</li>
            <li><b>✅ Quality Validation:</b> Automatic similarity checking prevents duplicate options - ensures you get 2 truly different alternatives (using Levenshtein distance)</li>
            <li><b>📐 Responsive Dialogs:</b> Completion preview dialog adapts to screen size (75% width × 65% height) - bigger previews on large monitors</li>
            <li><b>🎨 Better Parsing:</b> Handles markdown code blocks, multiple numbering formats (1. 1) 1:), and AI explanations gracefully</li>
        </ul>

        <h3>Version 1.9.905</h3>
        <ul>
            <li><b>💬 Chat UI Fixes:</b> Fixed MessageDetailDialog rendering issue - messages now display correctly with proper chat memory initialization</li>
            <li><b>🚀 Git UI Enhancements:</b> Added smart context limit detection (100KB max), diff size warnings, session timeout tracking, and progress indicators with elapsed time</li>
            <li><b>⌨️ Quick Action Redesign:</b> Context-aware menu with global actions ("Fill code", "Commit all"), disabled states with explanations, pure keyboard-first UX</li>
            <li><b>✨ Inline Code Completion:</b> AI-powered completion with 2 options side-by-side, syntax-highlighted preview panels, yellow-highlighted new code, includes open files context</li>
            <li><b>📊 Enhanced Error Visibility:</b> Better error handling in Git operations - users always know when operations fail and why (timeouts, context limits, etc.)</li>
            <li><b>🎯 State Management:</b> Improved button states in Git UI with spinners and text changes during operations ("Generating... 5s", "Committing...", "Pushing...")</li>
        </ul>

        <h3>Version 1.9.902</h3>
        <ul>
            <li><b>🏗️ Architecture Simplification:</b> Replaced complex Javalin proxy with lightweight ToolApiServer - cleaner, faster, easier to maintain</li>
            <li><b>🛠️ Multi-Project Tool Support:</b> Per-project tool servers with automatic filtering - work on multiple projects without tool conflicts</li>
            <li><b>🌐 OpenWebUI Integration:</b> Native tool integration with OpenAPI 3.1.0 schema, settings-based registration, and project-aware filtering</li>
            <li><b>🎯 Enhanced Agent Mode:</b> Added tool budget system (5 exploration tools max), code understanding patterns, and strategic usage guidelines</li>
            <li><b>💬 Modern Chat UI:</b> Redesigned chat interface with better styling, improved dark mode support, and simplified tool rendering</li>
            <li><b>🔧 Tool Enhancements:</b> Better file path resolution, improved lookup tools, and more robust code modification capabilities</li>
        </ul>

        <h3>Version 1.9.901</h3>
        <ul>
            <li><b>🛠️ Tool-Enabled Chat:</b> Added "Chat with Tools" action in Tools menu - normal chat with powerful code exploration capabilities</li>
            <li><b>🎨 UI Polish:</b> Reduced code block padding in chat for cleaner, more compact display</li>
        </ul>

        <h3>Version 1.9.900</h3>
        <ul>
            <li><b>🐛 Test Generation Bug Fixes:</b> Fixed duplicate test class display issue - tests now show correctly only once</li>
            <li><b>💬 Chat Memory Fix:</b> Fixed "View Chat" button functionality - now properly displays conversation history from TestWriterAgent</li>
            <li><b>🔄 Streaming Improvements:</b> TestWriterAgent now uses ChatUIService for proper real-time streaming display</li>
            <li><b>🎯 Context Agent Enhancements:</b> Improved context gathering with better prompts and more accurate analysis</li>
            <li><b>🤝 Human-in-the-Loop:</b> Added user intervention capability during test generation for better control</li>
            <li><b>🛠️ Test Tools:</b> Enhanced Ripgrep code search with better pattern matching and error handling</li>
            <li><b>📊 Test UX:</b> Improved test data flow, scenario display, and phase transition notifications</li>
            <li><b>🧹 Code Quality:</b> Major refactoring of TestWriterAgent for better maintainability and streaming support</li>
        </ul>

        <h3>Version 1.9.899</h3>
        <ul>
            <li><b>Responsive Git UI:</b> Improved responsiveness and performance of the Git interface</li>
            <li><b>Test Generation:</b> Enhanced phase start notifications and test strategy display in test generation</li>
            <li><b>Browser Stability:</b> Fixed null mode handling in browser debug logging to prevent crashes</li>
            <li><b>Project Configuration:</b> Cleaned up IDEA project settings for better maintainability</li>
            <li><b>Test Scenario Display:</b> Improved test scenario dialog with clearer formatting</li>
            <li><b>UI Polish:</b> Various small UI improvements in git interface and dialogs</li>
        </ul>

        <h3>Version 1.9.898</h3>
        <ul>
            <li><b>Smart JSON Parsing:</b> Introduced JsonParsingHelper with multiple fallback strategies for handling malformed LLM responses</li>
            <li><b>Code Health Resilience:</b> Analysis now preserves and displays partial results even when JSON parsing partially fails</li>
            <li><b>Simplified Completions:</b> Removed complex overlap detection for more predictable and stable code suggestions</li>
            <li><b>Issue Prioritization:</b> Code Health now shows only the most critical issues (max 5 per file) for better actionability</li>
            <li><b>Performance & Cleanup:</b> Removed ~400 lines of unnecessary code, all methods now under 20 lines for maintainability</li>
        </ul>

        <h3>Version 1.9.897</h3>
        <ul>
            <li><b>Simplified Completion System:</b> Removed complex overlap detection logic for more predictable completions</li>
            <li><b>Code Health Storage Fix:</b> Fixed issue where partial analysis results weren't being stored properly</li>
            <li><b>Better JSON Parsing:</b> Added JsonParsingHelper with multiple fallback strategies for malformed LLM responses</li>
            <li><b>Improved Resilience:</b> Code Health analysis now preserves partial results even when JSON parsing fails</li>
            <li><b>Code Cleanup:</b> Removed ~400 lines of unnecessary overlap detector code</li>
        </ul>

        <h3>Version 1.9.896</h3>
        <ul>
            <li><b>Enhanced Code Health Analysis:</b> Improved resilience when parsing LLM responses, ensuring partial results are still displayed</li>
            <li><b>Focused Issue Reporting:</b> Now shows only the most critical issue per method (max 5 per file) for better actionability</li>
            <li><b>Better Error Handling:</b> Replaced blocking dialogs with non-intrusive notifications</li>
            <li><b>Performance:</b> Increased analysis timeout to 5 minutes for complex codebases</li>
            <li><b>Code Quality:</b> Major refactoring - all methods now under 20 lines for better maintainability</li>
            <li><b>UI Improvements:</b> Enhanced chat panel scrolling and JCEF stability</li>
        </ul>
        <p><i>Bug fixes and stability improvements</i></p>
    ]]></change-notes>
</idea-plugin>
