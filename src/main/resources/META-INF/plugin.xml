<idea-plugin>
    <!-- Plugin name displayed in the IDE -->
    <!-- Read more: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Zest</name>
    
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.zps.Zest</id>
    
    <!-- Plugin version -->
    <version>1.9.891</version>

    <!-- Vendor information -->
    <vendor email="nhutnm3@vng.com.vn" url="https://www.vng.com.vn">Zingplay Game Studio</vendor>
    <!-- Plugin description -->
    <description><![CDATA[
   <h2>Zest: Smarter Java Development with AI</h2>
   <p><b>Zest</b> supercharges your IntelliJ workflow. Instantly generate JUnit tests, implement TODOs, and refactor for testability—all powered by AI. Enjoy one-click code reviews, auto-generated commit messages, and smart comments. Boost productivity, ship quality code, and let Zest handle the repetitive stuff so you can focus on building great software. Try Zest and make testing effortless.</p>]]></description>
    
    <!-- Compatibility version range -->
    <!-- Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>
    <idea-version since-build="223.0" until-build="259.*"/>
    
    <projectListeners>


        <listener class="com.zps.zest.inlinechat.JCefInitializer"
                  topic="com.intellij.openapi.startup.ProjectActivity"/>
    </projectListeners>
    
    <!-- Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Application-level service for global settings -->
        <applicationService serviceImplementation="com.zps.zest.settings.ZestGlobalSettings"/>
        
        <!-- Project-level service for project-specific settings -->
        <projectService serviceImplementation="com.zps.zest.settings.ZestProjectSettings"/>
        <!-- Using backgroundPostStartupActivity for better performance -->
        <backgroundPostStartupActivity implementation="com.zps.zest.completion.ZestCompletionStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.codehealth.CodeGuardianStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.settings.SettingsMigrationNotice"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.startup.PromptMigrationStartupActivity"/>
        <backgroundPostStartupActivity implementation="com.zps.zest.langchain4j.agent.network.ProxyStartupActivity"/>
        <editorFactoryListener implementation="com.zps.zest.events.ZestEditorFactoryListener"/>
        <actionPromoter order="first" implementation="com.zps.zest.completion.actions.ZestActionPromoter"/>

                    

            
        <projectConfigurable
                groupId="tools"
                instance="com.zps.zest.settings.ZestSettingsConfigurable"
                displayName="Zest Plugin"
                id="zest.settings"
                nonDefaultProject="true"/>

                
        <projectConfigurable
                instance="com.zps.zest.codehealth.CodeHealthConfigurable"
                displayName="Code Guardian"
                id="zest.codeguardian"
                parentId="zest.settings"
                nonDefaultProject="true"/>

        <notificationGroup id="Zest LLM" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>
        <notificationGroup id="Zest Completion Debug" displayType="BALLOON" isLogByDefault="false"/>
        <notificationGroup id="Zest Updates" displayType="BALLOON" isLogByDefault="false"/>


        <!-- Status Bar Widgets -->
        <statusBarWidgetFactory id="ZestCompletionStatus" 
                               implementation="com.zps.zest.completion.ui.ZestCompletionStatusBarWidgetFactory" 
                               order="last"/>
        <statusBarWidgetFactory id="CodeGuardianStatusBarWidget" 
                               implementation="com.zps.zest.codehealth.ui.CodeGuardianStatusBarWidgetFactory" 
                               order="last"/>

        
        <!-- Code Guardian Notification Group -->
        <notificationGroup id="Zest Code Guardian" displayType="BALLOON" isLogByDefault="false"/>
        
        <!-- Code Health Editor Provider -->
        <fileEditorProvider implementation="com.zps.zest.codehealth.ui.editor.CodeHealthEditorProvider"/>
        

        
        <!-- Zest Chat Editor Provider -->
        <fileEditorProvider implementation="com.zps.zest.browser.editor.ZestChatEditorProvider"/>
        <fileEditorProvider implementation="com.zps.zest.testgen.ui.TestGenerationEditorProvider"/>
        

        <!-- LangChain4j Services for agentic retrieval and AI task management -->
        <projectService serviceImplementation="com.zps.zest.langchain4j.ZestLangChain4jService"/>
        <projectService serviceImplementation="com.zps.zest.langchain4j.util.StreamingLLMService"/>
        <projectService serviceImplementation="com.zps.zest.retrieval.core.EmbeddingService"/>
        
        <!-- Inline Completion Services -->
        <projectService serviceImplementation="com.zps.zest.completion.ZestInlineCompletionService"/>
    </extensions>
    
    <actions>
        <group id="Zest.InlineCompletion" text="Zest Inline Completion">
            <action id="Zest.InlineCompletion.Trigger"
                    class="com.zps.zest.completion.actions.ZestTrigger"
                    text="Trigger Inline Completion"
                    description="Gợi ý code thông minh tại vị trí con trỏ">
            </action>

            <!-- Temporarily disabled - needs reimplementation
            <action id="Zest.InlineCompletion.ImmediateTrigger"
                    class="com.zps.zest.completion.actions.ZestTriggerBlockRewriteAction"
                    text="Immediate Inline Completion"
                    description="Gợi ý code nhanh với khả năng viết lại block (Ctrl+Space)">
                <keyboard-shortcut first-keystroke="ctrl SPACE" keymap="$default"/>
            </action>
            -->

            <action id="Zest.InlineCompletion.TabAccept"
                    class="com.zps.zest.completion.actions.ZestTabAccept"
                    text="Accept Completion (Tab)"
                    description="Chấp nhận gợi ý bằng phím Tab">
                <keyboard-shortcut first-keystroke="TAB" keymap="$default"/>
            </action>

            <!-- Temporarily disabled - needs reimplementation
            <action id="Zest.InlineCompletion.Accept"
                    class="com.zps.zest.completion.actions.ZestAccept"
                    text="Accept Completion"
                    description="Chấp nhận gợi ý bằng Ctrl+Tab">
                <keyboard-shortcut first-keystroke="ctrl TAB" keymap="$default"/>
            </action>
            -->

            <!-- Temporarily disabled - needs reimplementation
            <action id="Zest.InlineCompletion.CycleNext"
                    class="com.zps.zest.completion.actions.ZestCycleNext"
                    text="Cycle Next Completion"
                    description="Xem gợi ý tiếp theo (Alt+Down)">
                <keyboard-shortcut first-keystroke="alt DOWN" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.CyclePrevious"
                    class="com.zps.zest.completion.actions.ZestCyclePrevious"
                    text="Cycle Previous Completion"
                    description="Xem gợi ý trước đó (Alt+Up)">
                <keyboard-shortcut first-keystroke="alt UP" keymap="$default"/>
            </action>
            -->

            <action id="Zest.InlineCompletion.Dismiss"
                    class="com.zps.zest.completion.actions.ZestDismiss"
                    text="Dismiss Completion"
                    description="Hủy gợi ý (Escape)">
                <keyboard-shortcut first-keystroke="ESCAPE" keymap="$default"/>
            </action>
        </group>

        <group id="ZestGroup" text="Zest" description="AI-powered tools cho Java development" popup="true"
               icon="com.zps.zest.ZestIcons.ZEST">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>
        
        <!-- Open Chat in Editor Action -->
        <action id="Zest.OpenChatInEditor"
                class="com.zps.zest.browser.actions.OpenChatInEditorAction"
                text="💬 Open Chat in Editor"
                description="Open ZPS Chat in full-screen editor tab">
            <add-to-group group-id="ZestGroup" anchor="first"/>
        </action>



        <!-- Toolbar Actions -->
        <action id="Zest.OpenChat"
                class="com.zps.zest.browser.actions.OpenZestChatAction"
                text="💬 Chat"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT"
                description="Open ZPS AI Chat">
            <add-to-group group-id="MainToolbarRight" anchor="last"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift C"/>
        </action>

        <action id="Zest.OpenCodeHealth"
                class="com.zps.zest.codehealth.actions.OpenCodeHealthAction"
                text="🛡️ Health"
                icon="com.zps.zest.ZestIcons.CODE_HEALTH"
                description="Open Code Health Overview">
            <add-to-group group-id="MainToolbarRight" anchor="after" relative-to-action="Zest.OpenChat"/>
        </action>

        <!-- Temporarily disabled - needs reimplementation
        <action id="Zest.SendCodeReviewToChatBox"
                class="com.zps.zest.browser.actions.SendCodeReviewToChatBox"
                text="Code Review (Chat)"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"
                description="Review code và đưa ra gợi ý cải thiện">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>
        -->

        <action id="Zest.GitCommitMessageGeneratorAction"
                class="com.zps.zest.GitCommitMessageGeneratorAction"
                text="Generate Commit Message (Chat)"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"
                description="Tạo commit message tự động từ thay đổi code">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>



        <action id="com.zps.zest.langchain4j.agent.network.StartAgentProxyAction"
                class="com.zps.zest.langchain4j.agent.network.StartAgentProxyAction" text="Start Tools"
                description="Khởi động tools để dùng trong chat">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <!-- Removed from ToolsMenu - available in ZestGroup -->
        </action>
        
        <!-- Test Generation Action -->
        <action id="Zest.GenerateTests"
                class="com.zps.zest.testgen.actions.GenerateTestsAction"
                text="Generate Tests"
                icon="com.zps.zest.ZestIcons.TEST_WRITING_16"
                description="Generate unit and integration tests using AI">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.CreateRulesFile"/>
            <keyboard-shortcut first-keystroke="ctrl alt T" keymap="$default"/>
        </action>
        
        <!-- Code Health Group -->
        <group id="Zest.CodeHealth" text="Code Health Review" popup="true">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <!-- Removed from ToolsMenu - available in ZestGroup -->
            
            <action id="Zest.CheckCodeHealth"
                    class="com.zps.zest.codehealth.CheckHealthAction"
                    text="Activate Code Health Review"
                    description="Phân tích code đã thay đổi trong ngày để phát hiện lỗi tiềm ẩn">
            </action>
            
            <action id="Zest.AddMethodAtCaret"
                    class="com.zps.zest.codehealth.actions.AddMethodAtCaretAction"
                    text="Review This Method"
                    description="Theo dõi method này để kiểm tra chất lượng">
            </action>
            
            <action id="Zest.TriggerBackgroundReview"
                    class="com.zps.zest.codehealth.actions.TriggerBackgroundReviewAction"
                    text="Start Health Review"
                    description="Bắt đầu kiểm tra tự động tất cả method đang theo dõi">
            </action>
            
            <action id="Zest.TriggerFinalReview"
                    class="com.zps.zest.codehealth.actions.TriggerFinalReviewAction"
                    text="Health Daily Report"
                    description="Tạo báo cáo tổng hợp chất lượng code hàng ngày">
            </action>
        </group>
        
        <!-- Code Health Debug Actions Group -->
        <group id="Zest.CodeHealthDebug" text="Health Review Debug Tools" popup="true">
            <add-to-group group-id="Zest.CodeHealth" anchor="last"/>
            
            <action id="Zest.ShowReviewQueueStatus"
                    class="com.zps.zest.codehealth.actions.ShowReviewQueueStatusAction"
                    text="Health Watch List"
                    description="Xem danh sách method đang được theo dõi">
            </action>
            
            <action id="Zest.DebugHealthAction"
                    class="com.zps.zest.codehealth.DebugHealthAction"
                    text="Health Test Mode"
                    description="Chế độ test với dữ liệu mẫu">
            </action>
            
            <separator/>
            
            <action id="Zest.ShowGuardianHelp"
                    class="com.zps.zest.codehealth.actions.ShowGuardianHelpAction"
                    text="Health Review Help"
                    description="Xem hướng dẫn sử dụng">
            </action>
        </group>
        
        <!-- Moved debug actions to a debug submenu -->
        
        <!-- Zest Rules Management Action -->
        <action id="Zest.CreateRulesFile"
                class="com.zps.zest.actions.CreateZestRulesAction"
                text="Create/Open Zest Rules File"
                description="Create or open zest_rules.md to define custom LLM rules">
            <add-to-group group-id="ZestGroup" anchor="first"/>
        </action>
        
        <!-- Open Chat in Editor (also in Tools menu) -->
        <action id="Zest.OpenChatInEditorTools"
                class="com.zps.zest.browser.actions.OpenChatInEditorAction"
                text="💬 ZPS Chat (Editor)"
                description="Open ZPS Chat in full-screen editor tab">
            <add-to-group group-id="ToolsMenu" anchor="before" relative-to-action="Zest.TestGeneration"/>
        </action>
        
        <!-- Zest Update Info Action -->
        <action id="Zest.ShowUpdateInfo"
                class="com.zps.zest.update.ShowUpdateInfoAction"
                text="Check for Zest Updates..."
                description="Show update information and download options">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        
        <!-- Zest Debug Menu (only in Tools menu) -->
        <group id="Zest.DebugMenu" text="Zest Debug" popup="true">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            
            <action id="Zest.ShowCompletionTimingDebug"
                    class="com.zps.zest.actions.ZestCompletionTimingDebugAction"
                    text="Completion Timing Debug..."
                    description="Show detailed timing breakdown for recent completions"/>
            
            <!-- Temporarily disabled - debug action removed
            <action id="Zest.ToggleCompletionDebug"
                    class="com.zps.zest.actions.ToggleCompletionDebugAction"
                    text="Toggle Completion Debug Logging"
                    description="Enable/disable verbose debug logging for completion"/>
            -->
            
            <action id="Zest.ToggleDevTools"
                    class="com.zps.zest.browser.actions.ToggleDevToolsAction"
                    text="Toggle Browser DevTools"
                    description="Toggle developer tools for the chat browser"/>
                    
            <action id="Zest.TestEmbeddingRetrieval"
                    class="com.zps.zest.langchain4j.actions.TestEmbeddingRetrievalAction"
                    text="Test Embedding &amp; Retrieval"
                    description="Test the embedding service and context retrieval functionality"/>
        </group>
    </actions>
</idea-plugin>
