<idea-plugin>
    <!-- Plugin name displayed in the IDE -->
    <!-- Read more: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Zest</name>
    
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.zps.Zest</id>
    
    <!-- Plugin version -->
    <version>1.9.881</version>

    <!-- Vendor information -->
    <vendor email="nhutnm3@vng.com.vn" url="https://www.vng.com.vn">Zingplay Game Studio</vendor>
    <!-- Plugin description -->
    <description><![CDATA[
   <h2>Zest: Smarter Java Development with AI</h2>
   <p><b>Zest</b> supercharges your IntelliJ workflow. Instantly generate JUnit tests, implement TODOs, and refactor for testability—all powered by AI. Enjoy one-click code reviews, auto-generated commit messages, and smart comments. Boost productivity, ship quality code, and let Zest handle the repetitive stuff so you can focus on building great software. Try Zest and make testing effortless.</p>]]></description>
    
    <!-- Compatibility version range -->
    <!-- Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>
    <idea-version since-build="223.0" until-build="259.*"/>
    
    <projectListeners>
        <listener class="com.zps.zest.inlinechat.SelectionGutterIconManager"
                  topic="com.intellij.openapi.startup.ProjectActivity"/>

        <listener class="com.zps.zest.inlinechat.JCefInitializer"
                  topic="com.intellij.openapi.startup.ProjectActivity"/>
    </projectListeners>
    
    <!-- Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Application-level service for global settings -->
        <applicationService serviceImplementation="com.zps.zest.settings.ZestGlobalSettings"/>
        
        <!-- Project-level service for project-specific settings -->
        <projectService serviceImplementation="com.zps.zest.settings.ZestProjectSettings"/>
        <projectService serviceImplementation="com.zps.zest.settings.PromptMigrationService"/>
        <postStartupActivity implementation="com.zps.zest.completion.ZestCompletionStartupActivity"/>
        <postStartupActivity implementation="com.zps.zest.completion.debug.EnableVerboseLoggingStartup"/>
        <postStartupActivity implementation="com.zps.zest.codehealth.CodeGuardianStartupActivity"/>
        <postStartupActivity implementation="com.zps.zest.settings.SettingsMigrationNotice"/>
        <postStartupActivity implementation="com.zps.zest.startup.PromptMigrationStartupActivity"/>
        <editorFactoryListener implementation="com.zps.zest.events.ZestEditorFactoryListener"/>
        <actionPromoter order="first" implementation="com.zps.zest.completion.actions.ZestActionPromoter"/>

        <toolWindow id="ZPS Chat"
                    anchor="right"
                    factoryClass="com.zps.zest.browser.WebBrowserToolWindow"
                    icon="com.zps.zest.ZestIcons.ZPS_CHAT"
                    canCloseContents="false"/>
                    
        <toolWindow id="Code Guardian"
                    anchor="right"
                    factoryClass="com.zps.zest.codehealth.ui.CodeGuardianToolWindowFactory"
                    icon="com.zps.zest.ZestIcons.SHIELD"
                    canCloseContents="false"
                    doNotActivateOnStart="true"
                    secondary="true"/>

        <toolWindow id="Test Writing Assistant"
                    anchor="bottom"
                    factoryClass="com.zps.zest.testing.TestWritingToolWindowFactory"
                    icon="com.zps.zest.ZestIcons.TEST_WRITING"
                    canCloseContents="true"
                    doNotActivateOnStart="false"
                    secondary="false"/>

        <toolWindow id="Refactoring for Testability"
                    anchor="bottom"
                    factoryClass="com.zps.zest.refactoring.RefactoringToolWindowFactory"
                    icon="com.zps.zest.ZestIcons.REFACTORING"
                    canCloseContents="true"
                    doNotActivateOnStart="false"
                    secondary="false"/>
            
        <projectConfigurable
                groupId="tools"
                instance="com.zps.zest.settings.ZestSettingsConfigurable"
                displayName="Zest Plugin"
                id="zest.settings"
                nonDefaultProject="true"/>

        <projectConfigurable
                instance="com.zps.zest.langchain4j.HybridIndexConfigurable"
                displayName="Hybrid Code Search Index"
                id="zest.hybrid.index"
                parentId="tools"
                nonDefaultProject="true"/>
                
        <projectConfigurable
                instance="com.zps.zest.codehealth.CodeHealthConfigurable"
                displayName="Code Guardian"
                id="zest.codeguardian"
                parentId="zest.settings"
                nonDefaultProject="true"/>

        <notificationGroup id="Zest LLM" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>
        <notificationGroup id="Zest Completion Debug" displayType="BALLOON" isLogByDefault="false"/>

        <intentionAction>
            <className>com.zps.zest.inlinechat.InlineChatIntentionAction</className>
            <category>Zest</category>
            <descriptionDirectoryName>InlineChatIntentionAction</descriptionDirectoryName>
        </intentionAction>

        <highlightingPassFactory implementation="com.zps.zest.inlinechat.DiffHighlighterRegister"/>
        
        <!-- Status Bar Widgets -->
        <statusBarWidgetFactory implementation="com.zps.zest.completion.ui.ZestCompletionStatusBarWidgetFactory" order="last"/>
        <statusBarWidgetFactory implementation="com.zps.zest.codehealth.ui.CodeGuardianStatusBarWidgetFactory" order="last"/>
        
        <!-- Code Guardian Services -->
        <projectService serviceImplementation="com.zps.zest.codehealth.CodeHealthTracker"/>
        <projectService serviceImplementation="com.zps.zest.codehealth.CodeHealthAnalyzer"/>
        <projectService serviceImplementation="com.zps.zest.codehealth.CodeHealthVerificationAgent"/>
        <projectService serviceImplementation="com.zps.zest.codehealth.BackgroundHealthReviewer"/>
        <projectService serviceImplementation="com.zps.zest.codehealth.CodeHealthReportStorage"/>
        
        <!-- Code Guardian Notification Group -->
        <notificationGroup id="Zest Code Guardian" displayType="BALLOON" isLogByDefault="false"/>
    </extensions>
    
    <actions>
        <group id="Zest.InlineCompletion" text="Zest Inline Completion">
            <action id="Zest.InlineCompletion.Trigger"
                    class="com.zps.zest.completion.actions.ZestTrigger"
                    text="Trigger Inline Completion"
                    description="Gợi ý code thông minh tại vị trí con trỏ">
            </action>

            <action id="Zest.InlineCompletion.ImmediateTrigger"
                    class="com.zps.zest.completion.actions.ZestTriggerBlockRewriteAction"
                    text="Immediate Inline Completion"
                    description="Gợi ý code nhanh với khả năng viết lại block (Ctrl+Space)">
                <keyboard-shortcut first-keystroke="ctrl SPACE" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.TabAccept"
                    class="com.zps.zest.completion.actions.ZestTabAccept"
                    text="Accept Completion (Tab)"
                    description="Chấp nhận gợi ý bằng phím Tab">
                <keyboard-shortcut first-keystroke="TAB" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.Accept"
                    class="com.zps.zest.completion.actions.ZestAccept"
                    text="Accept Completion"
                    description="Chấp nhận gợi ý bằng Ctrl+Tab">
                <keyboard-shortcut first-keystroke="ctrl TAB" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.CycleNext"
                    class="com.zps.zest.completion.actions.ZestCycleNext"
                    text="Cycle Next Completion"
                    description="Xem gợi ý tiếp theo (Alt+Down)">
                <keyboard-shortcut first-keystroke="alt DOWN" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.CyclePrevious"
                    class="com.zps.zest.completion.actions.ZestCyclePrevious"
                    text="Cycle Previous Completion"
                    description="Xem gợi ý trước đó (Alt+Up)">
                <keyboard-shortcut first-keystroke="alt UP" keymap="$default"/>
            </action>

            <action id="Zest.InlineCompletion.Dismiss"
                    class="com.zps.zest.completion.actions.ZestDismiss"
                    text="Dismiss Completion"
                    description="Hủy gợi ý (Escape)">
                <keyboard-shortcut first-keystroke="ESCAPE" keymap="$default"/>
            </action>
        </group>

        <group id="ZestGroup" text="Zest" description="AI-powered tools cho Java development" popup="true"
               icon="com.zps.zest.ZestIcons.ZEST">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>

        <action id="Zest.SendPipelineToChatBox"
                class="com.zps.zest.browser.actions.SendTestPipelineToChatBox"
                text="Test Advisor (Chat)"
                icon="com.zps.zest.ZestIcons.TEST_WRITING_16"
                description="Phân tích class và đưa ra hướng dẫn viết test chi tiết">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>

        <action id="Zest.SendCodeReviewToChatBox"
                class="com.zps.zest.browser.actions.SendCodeReviewToChatBox"
                text="Code Review (Chat)"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"
                description="Review code và đưa ra gợi ý cải thiện">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>

        <action id="Zest.GitCommitMessageGeneratorAction"
                class="com.zps.zest.GitCommitMessageGeneratorAction"
                text="Generate Commit Message (Chat)"
                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"
                description="Tạo commit message tự động từ thay đổi code">
            <add-to-group group-id="ZestGroup" anchor="last"/>
        </action>

<!--        <action id="Zest.QuickCommitAction"-->
<!--                class="com.zps.zest.QuickCommitAction"-->
<!--                text="Quick Commit &amp; Push"-->
<!--                icon="com.zps.zest.ZestIcons.ZPS_CHAT_16"-->
<!--                description="Commit và push nhanh với message tự động (Ctrl+Shift+Z, C)">-->
<!--            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift Z" second-keystroke="C"/>-->
<!--            <add-to-group group-id="ZestGroup" anchor="after"-->
<!--                          relative-to-action="Zest.GitCommitMessageGeneratorAction"/>-->
<!--            <add-to-group group-id="VcsGroups" anchor="last"/>-->
<!--        </action>-->

        <action id="Zest.ToggleDevTools"
                class="com.zps.zest.browser.actions.ToggleDevToolsAction"
                text="Toggle ZPS Chat Developer Tools"
                description="Bật/tắt DevTools cho ZPS Chat">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="com.zps.zest.langchain4j.agent.network.StartAgentProxyAction"
                class="com.zps.zest.langchain4j.agent.network.StartAgentProxyAction" text="Start Tools"
                description="Khởi động tools để dùng trong chat">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        <!-- Code Guardian Group -->
        <group id="Zest.CodeGuardian" text="Code Guardian" popup="true">
            <add-to-group group-id="ZestGroup" anchor="last"/>
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            
            <action id="Zest.CheckCodeHealth"
                    class="com.zps.zest.codehealth.CheckHealthAction"
                    text="Activate Code Guardian"
                    description="Phân tích code đã thay đổi trong ngày để phát hiện lỗi tiềm ẩn">
            </action>
            
            <action id="Zest.AddMethodAtCaret"
                    class="com.zps.zest.codehealth.actions.AddMethodAtCaretAction"
                    text="Guard This Method"
                    description="Theo dõi method này để kiểm tra chất lượng">
            </action>
            
            <action id="Zest.TriggerBackgroundReview"
                    class="com.zps.zest.codehealth.actions.TriggerBackgroundReviewAction"
                    text="Start Guardian Patrol"
                    description="Bắt đầu kiểm tra tự động tất cả method đang theo dõi">
            </action>
            
            <action id="Zest.TriggerFinalReview"
                    class="com.zps.zest.codehealth.actions.TriggerFinalReviewAction"
                    text="Guardian Daily Report"
                    description="Tạo báo cáo tổng hợp chất lượng code hàng ngày">
            </action>
        </group>
        
        <!-- Code Guardian Debug Actions Group -->
        <group id="Zest.CodeGuardianDebug" text="Guardian Debugging Tools" popup="true">
            <add-to-group group-id="Zest.CodeGuardian" anchor="last"/>
            
            <action id="Zest.ShowReviewQueueStatus"
                    class="com.zps.zest.codehealth.actions.ShowReviewQueueStatusAction"
                    text="Guardian Watch List"
                    description="Xem danh sách method đang được theo dõi">
            </action>
            
            <action id="Zest.DebugHealthAction"
                    class="com.zps.zest.codehealth.DebugHealthAction"
                    text="Guardian Test Mode"
                    description="Chế độ test với dữ liệu mẫu">
            </action>
            
            <separator/>
            
            <action id="Zest.ShowGuardianHelp"
                    class="com.zps.zest.codehealth.actions.ShowGuardianHelpAction"
                    text="Guardian Help"
                    description="Xem hướng dẫn sử dụng">
            </action>
        </group>
        
        <!-- Zest Completion Debug Action -->
        <action id="Zest.ShowCompletionTimingDebug"
                class="com.zps.zest.actions.ZestCompletionTimingDebugAction"
                text="Zest Completion Timing Debug..."
                description="Show detailed timing breakdown for recent completions">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        <action id="Zest.ToggleCompletionDebug"
                class="com.zps.zest.actions.ToggleCompletionDebugAction"
                text="Toggle Completion Debug Logging"
                description="Enable/disable verbose debug logging for completion">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
