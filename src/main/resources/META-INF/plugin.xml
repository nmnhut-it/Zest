<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.zps.Zest</id>
    <version>1.9.840</version>  <!-- Replace with your actual version -->

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Zest</name>
    
    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="nhutnm3@vng.com.vn" url="https://www.vng.com.vn">Zingplay Game Studio</vendor>
    <description><![CDATA[
<h2>Zest: Smarter Java Development with AI</h2>
<p><b>Zest</b> supercharges your IntelliJ workflow. Instantly generate JUnit tests, implement TODOs, and refactor for testabilityâ€”all powered by AI. Enjoy one-click code reviews, auto-generated commit messages, and smart comments. Boost productivity, ship quality code, and let Zest handle the repetitive stuff so you can focus on building great software. Try Zest and make testing effortless.</p>
]]></description>
    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>
    
    <!-- IDE compatibility -->
    <idea-version since-build="223.0" until-build="251.*"/>

    <projectListeners>
        <listener class="com.zps.zest.RagManagerProjectListener"
                  topic="com.intellij.openapi.project.ProjectManagerListener"/>
        <!-- Register the selection gutter icon manager -->
        <listener class="com.zps.zest.inlinechat.SelectionGutterIconManager"
                  topic="com.intellij.openapi.startup.ProjectActivity"/>
    </projectListeners>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Register the web browser tool window factory -->
        <toolWindow id="ZPS Chat"
                    anchor="right"
                    factoryClass="com.zps.zest.browser.WebBrowserToolWindow"
                    icon="icons/zpsChat.svg"
                    canCloseContents="false"/>

        <!-- Register the test writing tool window factory -->
        <toolWindow id="Test Writing Assistant"
                    anchor="bottom"
                    factoryClass="com.zps.zest.testing.TestWritingToolWindowFactory"
                    icon="icons/testWriting.svg"
                    canCloseContents="true"
                    doNotActivateOnStart="false"
                    secondary="false"/>

        <!-- Register the refactoring tool window factory -->
        <toolWindow id="Refactoring for Testability"
                    anchor="bottom"
                    factoryClass="com.zps.zest.refactoring.RefactoringToolWindowFactory"
                    icon="icons/refactoring.svg"
                    canCloseContents="true"
                    doNotActivateOnStart="false"
                    secondary="false"/>

        <!-- Register notification group -->
        <notificationGroup id="Zest LLM" displayType="BALLOON" toolWindowId="Terminal" isLogByDefault="false"/>

        <!-- Register the intention action -->
        <intentionAction>
            <className>com.zps.zest.inlinechat.InlineChatIntentionAction</className>
            <category>Zest</category>
            <descriptionDirectoryName>InlineChatIntentionAction</descriptionDirectoryName>
        </intentionAction>

        <!-- Register project-level services -->
        <projectService serviceImplementation="com.zps.zest.inlinechat.InlineChatService"/>
        <projectService serviceImplementation="com.zps.zest.inlinechat.CommandHistory"/>
        <projectService serviceImplementation="com.zps.zest.inlinechat.InlineChatPreviewService"/>
        
        <!-- Register the diff highlighter -->
        <highlightingPassFactory implementation="com.zps.zest.inlinechat.DiffHighlighterRegister"/>

    </extensions>
    <actions>
        <group id="ZestGroup" text="Zest" description="Zest AI-powered development tools" popup="true" icon="icons/zest.svg">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>

        <!-- INLINE CHAT ACTIONS -->

        <!-- Inline Chat Actions -->
        <action id="Zest.InlineChatAction" 
                class="com.zps.zest.inlinechat.InlineChatAction"
                text="Inline AI Edit"
                icon="AllIcons.Actions.IntentionBulb"
                description="Open inline AI editor for context-aware editing">
            <keyboard-shortcut keymap="$default" first-keystroke="shift SPACE" replace-all="true" />
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </action>
        
        <!-- These actions will be triggered by UI buttons, not menu items -->
        <action id="Zest.InlineChatAcceptAction"
                class="com.zps.zest.inlinechat.InlineChatAcceptAction"
                text="Accept Inline Edit" 
                description="Accept the changes proposed by the inline AI editor"
                keymap="$default"
        />
                
        <action id="Zest.InlineChatDiscardAction"
                class="com.zps.zest.inlinechat.InlineChatDiscardAction"
                text="Discard Inline Edit" 
                description="Discard the changes proposed by the inline AI editor"/>

        <action id="Zest.InlineChatCancelAction"
                class="com.zps.zest.inlinechat.InlineChatCancelAction"
                text="Cancel Inline Edit"
                description="Cancel the inline AI editing operation">
        </action>
        <!-- Agent-based Test Writing --> 
        <action id="Zest.AgentBasedTestWritingAction"
                class="com.zps.zest.testing.AgentBasedTestWritingAction"
                text="Step-by-Step Test Writing (Agent)"
                icon="com.zps.zest.ZestIcons.TEST_WRITING"
                description="Use an AI agent to write comprehensive tests step-by-step, allowing fine-grained human interaction">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.InlineChatAction"/>
        </action>
        
        <!-- Quick Test Generator -->
        <action id="com.zps.zest.GenerateTestByLlm"
                class="com.zps.zest.GenerateTestByLlm"
                text="Quick Test Generator (Agent)"
                icon="com.zps.zest.ZestIcons.TEST_WRITING"
                description="Automatically generate tests for the current class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.AgentBasedTestWritingAction"/>
        </action>
        
        <!-- Test Advisor -->
        <action id="Zest.SendPipelineToChatBox"
                class="com.zps.zest.browser.actions.SendTestPipelineToChatBox"
                text="Test Advisor (Chat)"
                icon="com.zps.zest.ZestIcons.TEST_WRITING"
                description="Get advice on writing tests for this class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="com.zps.zest.GenerateTestByLlm"/>
        </action>

        <!-- REFACTORING ACTIONS -->
        
        <!-- Step-by-Step Refactoring -->
        <action id="Zest.AgentBasedRefactoringAction"
                class="com.zps.zest.refactoring.AgentBasedRefactoringAction"
                text="Step-by-Step Refactoring (Agent)"
                 icon="com.zps.zest.ZestIcons.TEST_WRITING"
                description="Use an AI agent to implement testability refactoring, allowing fine-grained human interaction">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.SendPipelineToChatBox"/>
        </action>
        
        <!-- Refactoring Advisor -->
        <action id="Zest.RefactorForTestabilityAction"
                class="com.zps.zest.RefactorForTestabilityAction"
                text="Refactoring Advisor (Chat)"
                 icon="com.zps.zest.ZestIcons.TEST_WRITING"
                description="Get advice on how to refactor the selected code for testability">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.AgentBasedRefactoringAction"/>
        </action>

        <!-- CODE ENHANCEMENT ACTIONS -->
        
        <!-- Code Review -->
        <action id="Zest.SendCodeReviewToChatBox"
                class="com.zps.zest.browser.actions.SendCodeReviewToChatBox"
                text="Code Review (Chat)"
                icon="icons/zpsChat16.svg"
                description="Get a code review for the current class">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.RefactorForTestabilityAction"/>
        </action>
        
        <!-- Add Comments -->
        <action id="Zest.GenerateCodeCommentsAction"
                class="com.zps.zest.browser.actions.GenerateCodeCommentsAction"
                text="Add Comments (Agent)"
                description="Generate comments for the selected code">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.SendCodeReviewToChatBox"/>
        </action>
        
        <!-- Implement TODOs -->
        <action id="com.zps.zest.ImplementTodosAction"
                class="com.zps.zest.ImplementTodosAction"
                text="Implement TODOs"
                description="Implement TODOs in selected code using AI">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.GenerateCodeCommentsAction"/>
        </action>

        <!-- VERSION CONTROL ACTIONS -->
        
        <!-- Generate Commit Message -->
        <action id="Zest.GitCommitMessageGeneratorAction"
                class="com.zps.zest.GitCommitMessageGeneratorAction"
                text="Generate Commit Message (Chat)"
                icon="icons/zpsChat16.svg"
                description="Generate a commit message based on git changes">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="com.zps.zest.ImplementTodosAction"/>
        </action>
        
        <!-- Simple Git Diff Viewer -->
<!--        <action id="Zest.ShowGitDiffAction"-->
<!--                class="com.zps.zest.diff.ShowGitDiffAction"-->
<!--                text="Show Git Diff Viewer"-->
<!--                description="Show a simple Git diff viewer for changed files">-->
<!--            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.GitCommitMessageGeneratorAction"/>-->
<!--            <add-to-group group-id="VcsGroups" anchor="last"/>-->
<!--        </action>-->

        <!-- DEVELOPER TOOLS -->
        
        <!-- Toggle Dev Tools -->
        <action id="Zest.ToggleDevTools"
                class="com.zps.zest.browser.actions.ToggleDevToolsAction"
                text="Toggle ZPS Chat Developer Tools"
                description="Toggle the visibility of developer tools in ZPS Chat">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
        <!-- Agent Framework Demo -->
        <action id="Zest.ShowAgentFramework"
                class="com.zps.zest.actions.ShowAgentFrameworkAction"
                text="Show Agent Framework Demo"
                description="Open the Agent Framework demo page in the browser">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.GitCommitMessageGeneratorAction"/>
            <add-to-group group-id="ToolsMenu" anchor="after" relative-to-action="Zest.ToggleDevTools"/>
        </action>
        
        <!-- Workflow Builder -->
        <action id="Zest.ShowWorkflowBuilder"
                class="com.zps.zest.actions.ShowWorkflowBuilderAction"
                text="Show Workflow Builder"
                description="Open the visual workflow builder for creating agent workflows">
            <add-to-group group-id="ZestGroup" anchor="after" relative-to-action="Zest.ShowAgentFramework"/>
            <add-to-group group-id="ToolsMenu" anchor="after" relative-to-action="Zest.ShowAgentFramework"/>
        </action>
    </actions>
</idea-plugin>