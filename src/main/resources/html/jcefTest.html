<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JCEF Browser Test Page</title>
    <style>
        body {
            margin: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        h1, h2 {
            color: #4CAF50;
        }
        
        .test-section {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .success {
            background: #1b5e20;
            color: #81c784;
            border: 1px solid #4caf50;
        }
        
        .error {
            background: #b71c1c;
            color: #ef5350;
            border: 1px solid #f44336;
        }
        
        .warning {
            background: #f57f17;
            color: #ffecb3;
            border: 1px solid #ffc107;
        }
        
        .info {
            background: #0d47a1;
            color: #90caf9;
            border: 1px solid #2196f3;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .code-block {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        #console-output {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .console-line {
            margin: 2px 0;
        }
        
        .console-info { color: #90caf9; }
        .console-success { color: #81c784; }
        .console-error { color: #ef5350; }
        .console-warn { color: #ffecb3; }
    </style>
</head>
<body>
    <h1>üß™ JCEF Browser Test Page</h1>
    <p>This page tests various aspects of the JCEF browser integration.</p>
    
    <div class="test-grid">
        <!-- Basic HTML/CSS Test -->
        <div class="test-section">
            <h2>1. Basic HTML/CSS Rendering</h2>
            <p>If you can read this text with proper styling, basic HTML/CSS is working.</p>
            <div class="test-result success">‚úÖ HTML/CSS rendering successful</div>
        </div>
        
        <!-- JavaScript Test -->
        <div class="test-section">
            <h2>2. JavaScript Execution</h2>
            <p>Testing JavaScript capabilities...</p>
            <div id="js-test-result" class="test-result info">Testing...</div>
            <button onclick="testJavaScript()">Run JS Test</button>
        </div>
        
        <!-- Resource Loading Test -->
        <div class="test-section">
            <h2>3. Resource Loading</h2>
            <p>Testing loading of various resource types...</p>
            <div id="resource-test-result"></div>
            <button onclick="testResourceLoading()">Test Resources</button>
        </div>
        
        <!-- IntelliJ Bridge Test -->
        <div class="test-section">
            <h2>4. IntelliJ Bridge</h2>
            <p>Testing communication with IntelliJ...</p>
            <div id="bridge-test-result" class="test-result info">Not tested yet</div>
            <button onclick="testIntellijBridge()">Test Bridge</button>
            <button onclick="testChunkedMessage()">Test Chunked Message</button>
        </div>
        
        <!-- Framework Loading Test -->
        <div class="test-section">
            <h2>5. Framework Loading</h2>
            <p>Checking loaded frameworks...</p>
            <div id="framework-test-result"></div>
            <button onclick="testFrameworks()">Check Frameworks</button>
        </div>
        
        <!-- DOM Manipulation Test -->
        <div class="test-section">
            <h2>6. DOM Manipulation</h2>
            <p>Testing dynamic content creation...</p>
            <div id="dom-test-container"></div>
            <button onclick="testDOMManipulation()">Test DOM</button>
        </div>
        
        <!-- Event Handling Test -->
        <div class="test-section">
            <h2>7. Event Handling</h2>
            <p>Testing event listeners...</p>
            <div id="event-test-result" class="test-result info">
                Click counter: <span id="click-counter">0</span>
            </div>
            <button id="event-test-btn">Click Me!</button>
        </div>
        
        <!-- Local Storage Test -->
        <div class="test-section">
            <h2>8. Local Storage</h2>
            <p>Testing browser storage capabilities...</p>
            <div id="storage-test-result"></div>
            <button onclick="testLocalStorage()">Test Storage</button>
        </div>
    </div>
    
    <!-- Console Output -->
    <div class="test-section" style="margin-top: 20px;">
        <h2>Console Output</h2>
        <div id="console-output"></div>
        <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <script>
        // Console logging helper
        const logToConsole = (message, type = 'info') => {
            const output = document.getElementById('console-output');
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
            
            // Also log to browser console
            console.log(`[JCEF Test] ${message}`);
        };
        
        const clearConsole = () => {
            document.getElementById('console-output').innerHTML = '';
        };
        
        // Test functions
        function testJavaScript() {
            logToConsole('Starting JavaScript test...', 'info');
            const resultEl = document.getElementById('js-test-result');
            
            try {
                // Test various JS features
                const tests = [];
                
                // ES6 features
                const arrow = () => 'Arrow functions work';
                tests.push(arrow());
                
                // Template literals
                const name = 'JCEF';
                tests.push(`Template literals with ${name} work`);
                
                // Array methods
                const arr = [1, 2, 3];
                tests.push(`Array map: ${arr.map(x => x * 2).join(',')}`);
                
                // Object destructuring
                const {a, b} = {a: 1, b: 2};
                tests.push(`Destructuring: a=${a}, b=${b}`);
                
                // Promises
                Promise.resolve('Promises work').then(msg => {
                    tests.push(msg);
                    
                    resultEl.className = 'test-result success';
                    resultEl.innerHTML = '‚úÖ JavaScript tests passed:<br>' + tests.join('<br>');
                    logToConsole('JavaScript test completed successfully', 'success');
                });
                
            } catch (error) {
                resultEl.className = 'test-result error';
                resultEl.textContent = '‚ùå JavaScript test failed: ' + error.message;
                logToConsole('JavaScript test failed: ' + error.message, 'error');
            }
        }
        
        async function testResourceLoading() {
            logToConsole('Starting resource loading test...', 'info');
            const resultEl = document.getElementById('resource-test-result');
            resultEl.innerHTML = '';
            
            const resources = [
                { type: 'CSS', url: 'jcef://resource/css/test.css' },
                { type: 'JavaScript', url: 'jcef://resource/js/test.js' },
                { type: 'JSON', url: 'jcef://resource/data/test.json' },
                { type: 'Image', url: 'jcef://resource/images/test.png' }
            ];
            
            for (const resource of resources) {
                const result = document.createElement('div');
                result.className = 'test-result info';
                result.textContent = `Testing ${resource.type}...`;
                resultEl.appendChild(result);
                
                try {
                    if (resource.type === 'Image') {
                        // Test image loading
                        const img = new Image();
                        img.onload = () => {
                            result.className = 'test-result success';
                            result.textContent = `‚úÖ ${resource.type} loading works (or 404 handled properly)`;
                            logToConsole(`${resource.type} test passed`, 'success');
                        };
                        img.onerror = () => {
                            result.className = 'test-result warning';
                            result.textContent = `‚ö†Ô∏è ${resource.type} not found (expected if not created)`;
                            logToConsole(`${resource.type} not found`, 'warn');
                        };
                        img.src = resource.url;
                    } else {
                        // Test fetch for other resources
                        const response = await fetch(resource.url);
                        if (response.ok) {
                            result.className = 'test-result success';
                            result.textContent = `‚úÖ ${resource.type} loading successful`;
                            logToConsole(`${resource.type} loaded successfully`, 'success');
                        } else {
                            result.className = 'test-result warning';
                            result.textContent = `‚ö†Ô∏è ${resource.type} returned ${response.status}`;
                            logToConsole(`${resource.type} returned ${response.status}`, 'warn');
                        }
                    }
                } catch (error) {
                    result.className = 'test-result error';
                    result.textContent = `‚ùå ${resource.type} loading failed: ${error.message}`;
                    logToConsole(`${resource.type} loading failed: ${error.message}`, 'error');
                }
            }
        }
        
        async function testIntellijBridge() {
            logToConsole('Testing IntelliJ Bridge...', 'info');
            const resultEl = document.getElementById('bridge-test-result');
            
            if (!window.intellijBridge) {
                resultEl.className = 'test-result error';
                resultEl.textContent = '‚ùå IntelliJ Bridge not found!';
                logToConsole('IntelliJ Bridge not found!', 'error');
                return;
            }
            
            try {
                resultEl.className = 'test-result info';
                resultEl.textContent = 'Calling IntelliJ...';
                
                // Test a simple bridge call
                const result = await window.intellijBridge.callIDE('getProjectInfo', {});
                
                resultEl.className = 'test-result success';
                resultEl.innerHTML = `‚úÖ Bridge working!<br>Project: ${result.projectName || 'Unknown'}`;
                logToConsole('IntelliJ Bridge test successful', 'success');
                
            } catch (error) {
                resultEl.className = 'test-result error';
                resultEl.textContent = '‚ùå Bridge call failed: ' + error.message;
                logToConsole('Bridge call failed: ' + error.message, 'error');
            }
        }
        
        async function testChunkedMessage() {
            logToConsole('Testing chunked message handling...', 'info');
            const resultEl = document.getElementById('bridge-test-result');
            
            if (!window.intellijBridge) {
                resultEl.className = 'test-result error';
                resultEl.textContent = '‚ùå IntelliJ Bridge not found!';
                return;
            }
            
            try {
                // Create a large message to test chunking
                const largeData = 'x'.repeat(2000); // 2KB of data
                
                resultEl.className = 'test-result info';
                resultEl.textContent = 'Sending large message...';
                
                const result = await window.intellijBridge.callIDE('showDialog', {
                    title: 'Chunked Message Test',
                    message: `Testing with ${largeData.length} bytes of data`
                });
                
                resultEl.className = 'test-result success';
                resultEl.textContent = '‚úÖ Chunked message handled successfully!';
                logToConsole('Chunked message test successful', 'success');
                
            } catch (error) {
                resultEl.className = 'test-result error';
                resultEl.textContent = '‚ùå Chunked message failed: ' + error.message;
                logToConsole('Chunked message failed: ' + error.message, 'error');
            }
        }
        
        function testFrameworks() {
            logToConsole('Checking loaded frameworks...', 'info');
            const resultEl = document.getElementById('framework-test-result');
            resultEl.innerHTML = '';
            
            const frameworks = [
                { name: 'IntelliJ Bridge', obj: window.intellijBridge },
                { name: 'LLM Provider', obj: window.LLMProvider },
                { name: 'Agent Framework', obj: window.AgentFramework },
                { name: 'Workflow Engine', obj: window.WorkflowEngine },
                { name: 'Workflow Builder', obj: window.WorkflowBuilder },
                { name: 'Research Agent', obj: window.ResearchAgent },
                { name: 'File API', obj: window.FileAPI },
                { name: 'Agent UI', obj: window.AgentUI }
            ];
            
            frameworks.forEach(fw => {
                const result = document.createElement('div');
                if (fw.obj) {
                    result.className = 'test-result success';
                    result.textContent = `‚úÖ ${fw.name} loaded`;
                    logToConsole(`${fw.name} is loaded`, 'success');
                } else {
                    result.className = 'test-result error';
                    result.textContent = `‚ùå ${fw.name} not found`;
                    logToConsole(`${fw.name} not found`, 'error');
                }
                resultEl.appendChild(result);
            });
        }
        
        function testDOMManipulation() {
            logToConsole('Testing DOM manipulation...', 'info');
            const container = document.getElementById('dom-test-container');
            container.innerHTML = '';
            
            try {
                // Create various elements
                const elements = [
                    { tag: 'div', text: 'Dynamic DIV created', style: 'color: #4CAF50;' },
                    { tag: 'button', text: 'Dynamic Button', onclick: () => alert('Dynamic button clicked!') },
                    { tag: 'input', type: 'text', placeholder: 'Dynamic input' },
                    { tag: 'select', options: ['Option 1', 'Option 2', 'Option 3'] }
                ];
                
                elements.forEach(elem => {
                    if (elem.tag === 'select') {
                        const select = document.createElement('select');
                        elem.options.forEach(opt => {
                            const option = document.createElement('option');
                            option.textContent = opt;
                            select.appendChild(option);
                        });
                        container.appendChild(select);
                    } else {
                        const el = document.createElement(elem.tag);
                        if (elem.text) el.textContent = elem.text;
                        if (elem.style) el.style = elem.style;
                        if (elem.type) el.type = elem.type;
                        if (elem.placeholder) el.placeholder = elem.placeholder;
                        if (elem.onclick) el.onclick = elem.onclick;
                        container.appendChild(el);
                    }
                    container.appendChild(document.createElement('br'));
                });
                
                const result = document.createElement('div');
                result.className = 'test-result success';
                result.textContent = '‚úÖ DOM manipulation successful';
                container.appendChild(result);
                logToConsole('DOM manipulation test successful', 'success');
                
            } catch (error) {
                const result = document.createElement('div');
                result.className = 'test-result error';
                result.textContent = '‚ùå DOM manipulation failed: ' + error.message;
                container.appendChild(result);
                logToConsole('DOM manipulation failed: ' + error.message, 'error');
            }
        }
        
        function testLocalStorage() {
            logToConsole('Testing local storage...', 'info');
            const resultEl = document.getElementById('storage-test-result');
            resultEl.innerHTML = '';
            
            try {
                // Note: localStorage might not work in JCEF
                const testKey = 'jcef-test-key';
                const testValue = 'JCEF Test Value ' + Date.now();
                
                // Try to set
                localStorage.setItem(testKey, testValue);
                
                // Try to get
                const retrieved = localStorage.getItem(testKey);
                
                if (retrieved === testValue) {
                    const result = document.createElement('div');
                    result.className = 'test-result success';
                    result.textContent = '‚úÖ LocalStorage is working';
                    resultEl.appendChild(result);
                    logToConsole('LocalStorage test successful', 'success');
                    
                    // Clean up
                    localStorage.removeItem(testKey);
                } else {
                    throw new Error('Retrieved value does not match');
                }
                
            } catch (error) {
                const result = document.createElement('div');
                result.className = 'test-result warning';
                result.textContent = '‚ö†Ô∏è LocalStorage not available (expected in JCEF): ' + error.message;
                resultEl.appendChild(result);
                logToConsole('LocalStorage not available (this is normal in JCEF)', 'warn');
            }
        }
        
        // Event handling test setup
        document.addEventListener('DOMContentLoaded', () => {
            logToConsole('Page loaded, setting up event handlers...', 'info');
            
            let clickCount = 0;
            const eventBtn = document.getElementById('event-test-btn');
            const counterSpan = document.getElementById('click-counter');
            
            if (eventBtn && counterSpan) {
                eventBtn.addEventListener('click', () => {
                    clickCount++;
                    counterSpan.textContent = clickCount;
                    logToConsole(`Button clicked ${clickCount} times`, 'info');
                });
            }
            
            // Auto-run basic test
            testJavaScript();
        });
        
        // Log page load
        logToConsole('JCEF Test Page loaded successfully', 'success');
        
        // Test console methods
        console.log('Console.log test');
        console.info('Console.info test');
        console.warn('Console.warn test');
        console.error('Console.error test');
    </script>
</body>
</html>
