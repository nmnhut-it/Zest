<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Workflow Builder</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #1a1a1a;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        #workflow-builder {
            width: 100%;
            height: 100%;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #4CAF50;
        }
        #error {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: #f44336;
            color: white;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Loading indicator -->
    <div id="loading">
        <h2>Loading Workflow Builder...</h2>
        <p>Initializing components...</p>
    </div>
    
    <!-- Error display -->
    <div id="error"></div>
    
    <!-- Container for workflow builder -->
    <div id="workflow-builder" style="display: none;"></div>
    
    <!-- Initialize after all scripts are loaded -->
    <script>
        function showError(message) {
            console.error(message);
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = message;
            document.getElementById('loading').style.display = 'none';
        }
        
        function checkDependencies() {
            console.log('Checking dependencies...');
            
            if (!window.AgentFramework) {
                showError('AgentFramework not loaded! Please ensure Agent Framework is initialized.');
                return false;
            }
            
            if (!window.AgentFramework.AgentRoles) {
                showError('AgentFramework.AgentRoles not found!');
                return false;
            }
            
            if (!window.WorkflowEngine) {
                showError('WorkflowEngine not loaded! Please ensure Workflow Engine is initialized.');
                return false;
            }
            
            if (!window.WorkflowBuilder) {
                showError('WorkflowBuilder not loaded! Please ensure Workflow Builder script is loaded.');
                return false;
            }
            
            return true;
        }
        
        function initializeWorkflowBuilder() {
            console.log('Initializing Workflow Builder...');
            
            try {
                // Hide loading, show container
                document.getElementById('loading').style.display = 'none';
                document.getElementById('workflow-builder').style.display = 'block';
                
                // Initialize the workflow builder
                window.WorkflowBuilder.initialize('workflow-builder');
                console.log('Workflow Builder initialized successfully');
                
            } catch (error) {
                showError('Failed to initialize Workflow Builder: ' + error.message);
                console.error('Initialization error:', error);
            }
        }
        
        // Wait for all dependencies to load
        let checkCount = 0;
        const maxChecks = 50; // 5 seconds maximum wait
        
        function waitForDependencies() {
            checkCount++;
            
            if (checkDependencies()) {
                initializeWorkflowBuilder();
            } else if (checkCount < maxChecks) {
                // Try again in 100ms
                setTimeout(waitForDependencies, 100);
            } else {
                showError('Timeout waiting for dependencies. Please check console for errors.');
            }
        }
        
        // Start checking after a small delay to ensure scripts are injected
        window.addEventListener('load', function() {
            console.log('Page loaded, starting dependency check...');
            setTimeout(waitForDependencies, 500);
        });
        
        // Also listen for a custom event in case scripts load later
        window.addEventListener('agentFrameworkReady', function() {
            console.log('Agent Framework ready event received');
            if (checkDependencies() && !window.WorkflowBuilder.initialized) {
                initializeWorkflowBuilder();
            }
        });
    </script>
</body>
</html>
